!function(t){var a="pro",e="//i.gamersky.com/";"dev"===a&&(e="//192.168.0.100:9014/apis/");var i={getWapCardContext:function(a,i,n){var o=e+"club/api/getwapcardcontext";t.ajax({type:"get",dataType:"json",url:o,data:a,beforeSend:function(){"function"==typeof n&&n()},success:function(t){"function"==typeof i&&i(t)},error:function(t){console.log(t)}})},getWapClubContext:function(a,i,n){var o=e+"club/api/getwapclubcontent";t.ajax({type:"get",dataType:"json",url:o,data:a,beforeSend:function(){"function"==typeof n&&n()},success:function(t){"function"==typeof i&&i(t)},error:function(t){console.log(t)}})},getCommentCount:function(a,i,n){var o=e+"club/api/getcommentcount";t.ajax({type:"get",dataType:"jsonp",url:o,data:a,beforeSend:function(){"function"==typeof n&&n()},success:function(t){"function"==typeof i&&i(t)},error:function(t){console.log(t)}})},getWapClubComment:function(a,i,n){var o=e+"club/api/getwapclubcomment";t.ajax({type:"get",dataType:"json",url:o,data:a,beforeSend:function(){"function"==typeof n&&n()},success:function(t){"function"==typeof i&&i(t)},error:function(t){console.log(t)}})},getwapclubuserlike:function(a,i,n){var o=e+"club/api/getwapclubuserlike";t.ajax({type:"get",dataType:"json",url:o,data:a,beforeSend:function(){"function"==typeof n&&n()},success:function(t){"function"==typeof i&&i(t)},error:function(t){console.log(t)}})},getLike:function(a,i,n){var o=e+"club/api/getlike";t.ajax({type:"get",dataType:"jsonp",url:o,data:a,beforeSend:function(){"function"==typeof n&&n()},success:function(t){"function"==typeof i&&i(t)},error:function(t){console.log(t)}})},addLike:function(a,i,n){var o=e+"club/api/addlike";t.ajax({type:"get",dataType:"jsonp",url:o,data:a,beforeSend:function(){"function"==typeof n&&n()},success:function(t){"function"==typeof i&&i(t)},error:function(t){console.log(t)}})},addlikecomment:function(a,i,n){var o=e+"club/api/addlikecomment";t.ajax({type:"get",dataType:"jsonp",url:o,data:a,beforeSend:function(){"function"==typeof n&&n()},success:function(t){"function"==typeof i&&i(t)},error:function(t){console.log(t)}})},getWapClubCommentwr:function(a,i,n){var o=e+"club/api/getwapclubcommentwr";t.ajax({type:"get",dataType:"jsonP",url:o,data:a,beforeSend:function(){"function"==typeof n&&n()},success:function(t){"function"==typeof i&&i(t)},error:function(t){console.log(t)}})}},n={listNavSetter:{"new":{sort:1,type:0},hot:{sort:2,type:0},best:{sort:1,type:1}},innerCommentState:"close"},o=function(t){return"undefined"!=typeof t&&t.replace(/(^\s*)|(\s*$)/g,"")};t.fn.extend({textareaAutoHeight:function(a){this._options={minHeight:0,maxHeight:1e3},this.init=function(){for(var e in a)this._options[e]=a[e];0==this._options.minHeight&&(this._options.minHeight=parseFloat(t(this).height()));for(var e in this._options)null==t(this).attr(e)&&t(this).attr(e,this._options[e]);t(this).keyup(this.resetHeight).change(this.resetHeight).focus(this.resetHeight)},this.resetHeight=function(){var a=parseFloat(t(this).attr("minHeight")),e=parseFloat(t(this).attr("maxHeight"));t.browser.msie||t(this).height(0);var i=parseFloat(this.scrollHeight);i=i<a?a:i>e?e:i,t(this).height(i).scrollTop(i),t(this).css("overflow-y",i>=e?"scroll":"hidden")},this.init()}});var c={isCanLoading:!0,loadingDom:'<div class="qz-loading">正在加载</div>',loadedDom:'<div class="qz-loaded">全部加载完成</div>',loadnullDom:'<div class="qz-loadnull">还没有内容</div>'},s={setRem:function(){var a=t(window).width();a>=640&&(a=640),t("html").css({"font-size":a/6.4+"px"})},popCommon:{open:function(){t("html").addClass("hideScroll"),t(".ymw-backtotop").css("display","none")},close:function(){t("html").removeClass("hideScroll"),t(".ymw-backtotop").css("display","block")}},createCard:function(a){var e="";if(e+='<div class="qz-card qzCard" data-cid="'+a.cardid+'">',e+='<header><a class="head"><img src="'+a.head+'" alt="head"></a>',e+='<div class="info"><h5>',e+="<a>"+a.user+"</a>",o(a.vauth)&&(e+='<img src="'+a.vauth+'">'),e+="</h5><p>",e+='<span class="time">'+a.createtime+"</span>",e+="</p>",e+="</div>",a.spectop!==!0&&a.specvalue!==!0||(e+='<div class="spec-icons">',a.spectop===!0&&(e+='<a class="spec-top">置顶</a>'),a.specvalue===!0&&(e+='<a class="spec-value">精</a>'),e+="</div>"),e+="</header>",e+='<section class="detail qzZoneHref" data-href="'+a.url+'">',e+='<div class="content">',a.isVideo?(e+=a.text,e+="<a href="+a.video.src+' class="link-video">'+a.video.videoTitle+"</a>"):e+=a.text,e+="</div>",a.piclist.length>0&&(e+='<div class="media-pic-list"><div class="clearfix qz-figs qzPicPswp">',t.each(a.piclist,function(t,a){e+='<figure class="qzPicPswpBtn',"gif"===a.ext?(e+=' gif"',a.large=a.origin):"long"===a.ext&&(e+=' long"'),e+='"><a data-picType="'+a.ext+'" data-origin="'+a.origin+'"  data-large="'+a.large+'" data-size="'+a.size+'"><img src="'+a.url+'"></a></figure>'}),e+="</div></div>"),void 0!=a.picbig.large){a.picbig.large=a.picbig.url;var i="";e+='<div class="qzPicPswp media-pic',"gif"===a.picbig.ext?(i=" gif",a.picbig.large=a.picbig.origin):"long"===a.picbig.ext&&(i=" long"),e+='"><figure class="'+i+'"><a  data-picType="'+a.picbig.ext+'" data-origin="'+a.picbig.origin+'" data-large="'+a.picbig.large+'" data-size="'+a.picbig.size+'"><img src="'+a.picbig.url+'" class="qzPicPswpBtn"></a></figure></div>'}a.isVideo&&(e+='<div class="media-video">',e+='<a class="qzVideoPopBtn" data-href="'+a.video.src+'"><img src="'+a.video.pic+'" alt=""></a></div>'),e+="</section>",a.fromUrl&&(e+='<div class="from">来自：<a href="'+a.fromUrl+'" >'+a.from+"</a></div>"),e+="<footer>";var n=a.text.replace(/<[^>]+>/g,"").substring(0,200);return e+='<a class="btn-share qzBtnShare" data-sharetext="'+n+'" data-shareurl="'+a.url+'">分享</a>',e+='<span></span><a class="btn-comment qzBtnComment" data-commcount=""  data-clubcontentid="'+a.cardid+'"   data-href="'+a.url+'">0</a>',e+='<span></span><a class="btn-like qzBtnLike" data-likecount="" data-clubcontentid="'+a.cardid+'" ><i></i><b>0</b></a>',e+="</footer>",e+="</div>",e+="",e+=""},addSwpOnce:function(){var a='<div class="pswp pswpClub" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button><a target="_blank" class="pswp__button pswpBtnOrigin pswp__single-tap" title="查看原图"></a> <button class="pswp__button pswp__button--share" title="Share"></button> <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button> <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button> <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div>';t("body").append(a)},photoSwp:function(){var a=function(a){for(var e=function(t){for(var a,e,i,n,o=t.childNodes,c=o.length,s=[],r=0;r<c;r++)a=o[r],1===a.nodeType&&(e=a.children[0],i=e.getAttribute("data-size").split("x"),n={src:e.getAttribute("data-large"),w:parseInt(i[0],10),h:parseInt(i[1],10),ori:e.getAttribute("data-origin"),picType:e.getAttribute("data-picType")},a.children.length>1&&(n.title=a.children[1].innerHTML),e.children.length>0&&(n.msrc=e.children[0].getAttribute("src")),n.el=a,s.push(n));return s},i=function l(t,a){return t&&(a(t)?t:l(t.parentNode,a))},n=function(t){t=t||window.event,t.preventDefault?t.preventDefault():t.returnValue=!1;var a=t.target||t.srcElement,e=i(a,function(t){return t.tagName&&"FIGURE"===t.tagName.toUpperCase()});if(e){for(var n,c=e.parentNode,s=e.parentNode.childNodes,r=s.length,l=0,d=0;d<r;d++)if(1===s[d].nodeType){if(s[d]===e){n=l;break}l++}return n>=0&&o(n,c),!1}},o=function(a,i,n,o){function c(a){t(".pswpClub .pswpBtnOrigin").attr("href",l[a].ori)}var s,r,l,d=t(".pswpClub")[0];if(l=e(i),r={shareEl:!1,fullscreenEl:!1,zoomEl:!1,bgOpacity:1,showHideOpacity:0,galleryUID:i.getAttribute("data-pswp-uid"),history:!1,tapToClose:!0,getThumbBoundsFn:function(t){var a=l[t].el.getElementsByTagName("img")[0],e=window.pageYOffset||document.documentElement.scrollTop,i=a.getBoundingClientRect();return{x:i.left,y:i.top+e,w:i.width}}},o)if(r.galleryPIDs){for(var p=0;p<l.length;p++)if(l[p].pid==a){r.index=p;break}}else r.index=parseInt(a,10)-1;else r.index=parseInt(a,10);isNaN(r.index)||(n&&(r.showAnimationDuration=0),s=new PhotoSwipe(d,PhotoSwipeUI_Default,l,r),s.init(),s.listen("initialZoomIn",function(){c(s.getCurrentIndex()),t(".pswpClub").animate({opacity:1},333)}),s.listen("initialZoomOut",function(){t(".pswpClub").animate({opacity:0},200)}),s.listen("afterChange",function(){c(s.getCurrentIndex())}))},c=document.querySelectorAll(a),s=0,r=c.length;s<r;s++)c[s].setAttribute("data-pswp-uid",s+1),c[s].onclick=n};a(".qzPicPswp")},insertCard:function(a,e){var i="";t.each(e,function(t,a){i+=s.createCard(a)}),t(a).html(i),t(".qzBtnLike").like(),t(".qzBtnLike").addLike(),t(".qzCard .content").removeTarget(),t(".qzBtnComment").commentCount(),s.photoSwp(),s.openVideoPop()},appendCard:function(a,e){var i="";t.each(e,function(t,a){i+=s.createCard(a)}),t(a).append(i),t(".qzBtnLike").like(),t(".qzBtnLike").addLike(),t(".qzCard .content").removeTarget(),t(".qzBtnComment").commentCount(),s.photoSwp(),s.openVideoPop()},addContext:function(){function e(a){function e(){s.find(".realIpt").on("input",function(){s.find(".mathIpt").val(s.find(".realIpt").val());var t=s.find(".mathIpt")[0].scrollHeight;s.find(".realIpt").css("height",t)})}function i(){s.removeClass("cur"),t("html,body").removeClass("hideScroll").animate({scrollTop:a},0),setTimeout(function(){s.remove()},250)}var n=t(".topic").attr("data-topic");""==n&&(n=t(".topic").attr("data-selecttopic"));var c="";c+='<div class="qz-pop qzPop">',c+='<header>发布内容<a class="qz-pop-close qzPopClose"></a><a class="qz-pop-smt qzPopSmt">发布</a></header>',c+='<div class="pop-con">',c+='<div class="pop-srl"><textarea class="realIpt" placeholder="分享你的游戏心得...">',o(n)&&(c+=n),c+='</textarea > <textarea class="mathIpt" rows="3"></textarea></div > ',c+='<div class="clearfix qz-pic-list">',c+='<div class="qz-pic-list-li"><label for="qzSelectPhoto" class="qz-pic-list-add"></label></div>',c+="</div>",c+='<input id="fileupload" data-imagesize="5120"  type="file" style="display:none" name="files" method="POST" multiple="">',c+="</div>",c+='<footer><label for="qzSelectPhoto" class="qz-upload-pic qzUploadPic">图片</label><select class="qz-pop-sel">',c+="</select>",c+="</footer></div>",t("body").append(c);var s=t(".qzPop"),r=t(".clubList").html();t(".qz-pop-sel").html(r),t(".qz-pic-list-add,.qzUploadPic").selectPhoto(),t(".qz-pop-sel").change(function(a){a.preventDefault();var e=t(this).find("option:selected").val();t(".clubId").attr("data-selectclubid",e)}),setTimeout(function(){s.addClass("cur")},10),e(),t(".qzPopClose").on("click",i),s.fabuSubmit(a)}t("#qzMain").on("click",".qzBtnContext",function(){t(this).UserOnline(function(i){if("ok"==i.status||"dev"===a){var n=t("html").scrollTop();0===n&&(n=t("body").scrollTop()),setTimeout(function(){t("html,body").addClass("hideScroll")},300),e(n)}})})},addComment:function(){function e(a,e,i,n,o){function c(){d.find(".realIpt").on("input",function(){d.find(".mathIpt").val(d.find(".realIpt").val());var t=d.find(".mathIpt")[0].scrollHeight;d.find(".realIpt").css("height",t)})}function s(){d.removeClass("cur"),t("html,body").removeClass("hideScroll").animate({scrollTop:a},0),setTimeout(function(){d.remove()},250)}var r="",l=n?"回复 "+n+"：":"我来说两句...";r+='<div class="qz-pop qzPop">',r+='<header>评论<a class="qz-pop-close qzPopClose"></a><a data-userId="'+o+'" data-clubContentId="'+e+'"  data-commentId="'+i+'" class="qz-pop-smt qzPopSmt">发布</a></header>',r+='<div class="pop-con"><div class="pop-srl"><textarea class="realIpt" placeholder="'+l+'"></textarea><textarea class="mathIpt" rows="3"></textarea></div></div>',r+="</div>",t("body").append(r);var d=t(".qzPop");setTimeout(function(){d.addClass("cur")},10),c(),t(".qzPopClose").on("click",s),t(".qzPopSmt").on("click",function(){d.find(".realIpt").val();t(this).addComment(a)})}function i(i){i.UserOnline(function(n){if("ok"==n.status||"dev"===a){var o=t("html").scrollTop(),c=i.data("clubcontentid"),s=(i.data("commcount"),i.data("href"),i.data("userid")),r=i.data("commid"),l=i.attr("data-name");0===o&&(o=t("body").scrollTop()),setTimeout(function(){t("html,body").addClass("hideScroll")},300),e(o,c,r,l,s)}})}t("#qzMain").on("click",".qzBtnComment",function(){var i=t(this),n=i.data("commcount"),o=i.data("href");return n>0&&t("#qzCardContext").length<1?(window.open(o,"_blank"),!1):void i.UserOnline(function(n){if("ok"==n.status||"dev"===a){var o=t("html").scrollTop(),c=i.data("clubcontentid"),s=i.data("commcount"),r=i.data("userid"),l=i.data("commid"),d=i.attr("data-name");if(t("#qzCardContext").length>0)return 0===o&&(o=t("body").scrollTop()),setTimeout(function(){t("html,body").addClass("hideScroll")},300),e(o,c,l,d,r),!1;0!==s&&""!=s||(0===o&&(o=t("body").scrollTop()),setTimeout(function(){t("html,body").addClass("hideScroll")},300),e(o,c,l,d,r))}})}),t("#qzMain").on("click",".qzBtnCommentInner",function(){var a=t(this);i(a)})},initPageTopic:function(){var a="#qzCardListTopic",i=t(a);if(i.length>0){var n=e+"club/api/GetWapClubContentByTopic",o=t(".clubId").attr("data-selectClubId"),r=t(".topic").attr("data-topic"),l={clubId:o,topicTitle:r,pageIndex:0};t.ajax({type:"post",dataType:"json",url:n,data:{jsondata:JSON.stringify(l)},beforeSend:function(){i.append(c.loadingDom)},success:function(e){var n=t.parseJSON(e.body);"ok"===n.dataType&&n.cardgroup.length>0?(t(".comeFrom").html(n.cardgroup[0].from),i.attr("data-page",n.page),i.attr("data-moreload","open"),s.insertCard(a,n.cardgroup),n.count<=1&&t(".qzCardMoreBtn").remove(),t(".qz-rem").css("display","block")):i.html(c.loadnullDom)}})}},initPageContext:function(){var e="#qzCardContext",n=t(e);if(n.length>0){var o={clubContentId:n.attr("data-cid")},r={jsondata:JSON.stringify(o)};i.getWapCardContext(r,function(a){var i=t.parseJSON(a.body);"ok"===i.dataType?(n.attr("data-page",i.page),s.insertCard(e,i.cardgroup)):n.html(c.loadnullDom)},function(){n.append(c.loadingDom)});var l={vmBuild:function(){var e=t("#clubCardComment").data("cid"),n={template:'                                <div class="info-comment">                                    <div v-for="item in therld" class="ic-item qzBtnCommentInner" :data-clubcontentid="theCid" :data-commid="item.commId" :data-name="item.name" :data-userid="item.userId">                                        <a class="ici-name">{{item.name}}</a>                                        <i v-if="item.reply" class="ici-rpy">回复</i>                                        <a v-if="item.reply" class="ici-name">{{item.reply}}</a>                                        <a class="ici-name">：&nbsp;</a><span class="ici-context">{{item.context}}</span>                                    </div>                                    <a class="info-comment-more" v-if="more" :class="moregray?\'disable\':\'\'" @click="moreBtn">{{moretxt}}</a>                                </div>                            ',data:function(){return{more:!1,moretxt:"查看全部"+(this.count-2)+"条回复",moregray:!1,page:1,pagesize:10,therld:this.rld,theCid:this.cid}},props:["rld","cid","count","commid"],created:function(){this.count>2&&(this.more=!0)},methods:{moreBtn:function(){(this.page-2)*this.pagesize<=this.count-2&&this.getListData()},getListData:function(){var t=this,a={clubContentId:e,pageIndex:1,pageSize:1,sort:0,clubCommentId:t.commid,replyPageIndex:t.page,replyPageSize:t.pagesize},n={jsondata:JSON.stringify(a)};i.getWapClubCommentwr(n,function(a){var e=a.body;if(0===a.errorCode){e=a.result;var i=e.commlist[0].reply;if(1===t.page&&i.splice(0,2),t.therld=t.therld.concat(i),t.pagesize*t.page+2>=t.count)t.moretxt="全部加载完成",t.moregray=!0;else{var n;n=t.page<1?t.count-t.pagesize*t.page-2:t.count-t.pagesize*t.page,t.moretxt="查看剩余"+n+"条回复"}t.page++}},function(){t.moretxt="加载中..."})}}},o={template:'                                <li>                                    <a class="head"><img :src="item.head" :alt="item.name"></a>                                    <div class="info">                                        <h5>{{item.name}}<a class="info-like qzCardLike" @click="qzCardLike(item.commId)">{{item.replyLike}}</a></h5>                                        <div class="info-others"><span class="info-time">{{item.replyTime}}</span></div>                                        <div class="context qzBtnCommentInner" :data-clubcontentid="item.clubContentId" :data-commid="item.commId" :data-name="item.name" :data-userid="item.userId" v-html="item.context"></div>                                        <comm-line v-if="item.replyCount>0" :count="item.replyCount" :cid="item.clubContentId" :rld="item.reply" :commid="item.commId"></comm-line>                                     </div>                                </li>                            ',data:function(){return{item:[]}},props:["item"],components:{CommLine:n},mounted:function(){},methods:{qzCardLike:function(e){var n=this;t(this).UserOnline(function(t){if("ok"==t.status||"dev"===a){var o={commentId:e,fromDevice:1},c={jsondata:JSON.stringify(o)};i.addlikecomment(c,function(t){"err"==t.status?alert(t.body):n.item.replyLike++})}})}}},c={template:'                                <div v-if="hotshow" class="club-card-comment-list-hot">                                    <h4>热门评论</h4>                                    <ul class="club-card-comment-list">                                        <comm-li v-for="(item,idx) in lists" :item="item" :key="idx"></comm-li>                                    </ul>                                </div>                            ',data:function(){return{page:1,lists:[],hotshow:!1}},created:function(){var t=this,a={clubContentId:e,isHot:1,pageIndex:t.page,pageSize:1e3,replyPageIndex:1,replyPageSize:2},n={jsondata:JSON.stringify(a)};i.getWapClubCommentwr(n,function(a){if(0===a.errorCode){var e=a.result;e.commlist.length>0&&(t.hotshow=!0,t.lists=e.commlist)}else console.log(a.errorMessage)})},components:{CommLine:n,CommLi:o}},s={template:'                                <div v-if="allshow" class="club-card-comment-list-all">                                    <nav><a v-for="(nav,idx) in navs" :class="nav.sort===sort?\'cur\':\'\'" @click="sortChange(idx)">{{nav.txt}}</a></nav>                                    <ul class="club-card-comment-list">                                        <comm-li v-for="(item,idx) in navs[sort].list" :item="item" :key="idx"></comm-li>                                    </ul>                                    <a class="club-card-comment-more" @click="getMore" v-html="moreState[navs[sort].more]"></a>                                </div>                            ',data:function(){return{sort:1,eachnum:10,moreState:["查看更多","全部加载完成","<i></i>正在加载"],navs:[{txt:"最早",sort:0,page:1,pageall:0,more:1,list:[]},{txt:"最新",sort:1,page:1,pageall:0,more:1,list:[]}],lists:[],allshow:!1}},created:function(){this.getList(this.navs[this.sort].page)},components:{CommLine:n,CommLi:o},methods:{getList:function(t){var a=this,n={clubContentId:e,pageIndex:t,pageSize:a.eachnum,sort:a.sort,replyPageIndex:1,replyPageSize:2},o={jsondata:JSON.stringify(n)};i.getWapClubCommentwr(o,function(t){if(0===t.errorCode){var e=t.result;a.allshow=!0,a.navs[a.sort].pageall=e.count,a.navs[a.sort].list=a.navs[a.sort].list.concat(e.commlist),a.navs[a.sort].page*a.eachnum<e.count?a.navs[a.sort].more=0:a.navs[a.sort].more=1}else console.log(t.errorMessage)},function(){a.navs[a.sort].more=2})},sortChange:function(t){var a=this;a.sort=t,a.navs[t].list.length<1&&a.getList(a.navs[a.sort].page)},getMore:function(){function t(){a.getList(++a.navs[a.sort].page)}var a=this;a.navs[a.sort].page*a.eachnum<a.navs[a.sort].pageall&&t()}}},r={template:'<div class="club-card-comment-box"><comm-hot></comm-hot><comm-all></comm-all></div>',components:{CommHot:c,CommAll:s}};new Vue({el:"#clubCardComment",components:{VmMain:r}})},init:function(){this.vmBuild()}};l.init()}},infiniteLoad:function(a,e){function i(){var i=t(a);"open"===i.attr("data-infiload")&&"function"==typeof e&&e(a,i)}function n(){var a=t("html").scrollTop(),e=t(document).height(),n=t(window).height();0===a&&(a=t("body").scrollTop()),a>e-n-100&&a>n-e&&c.isCanLoading===!0&&(c.isCanLoading=!1,i())}t(a).length>0&&t(window).scroll(function(){n()})},topicMore:function(){var a=t(".qzCardMoreBtn");a.on("click",function(){var i=t("#qzCardListTopic");if(i.length>0&&"open"===i.attr("data-moreload")){var n=e+"club/api/GetWapClubContentByTopic",o=t(".clubId").attr("data-selectClubId"),r=t(".topic").attr("data-topic"),l=i.find(".qzCard").attr("data-cid"),d=parseInt(i.attr("data-pageIndex")),p=0==d?9:10;d=0==d?1:d+1;var u={clubId:o,topicTitle:r,excludeclubContentId:l,pageIndex:d,pageSize:p};t.ajax({type:"get",dataType:"json",url:n,data:{jsondata:JSON.stringify(u)},beforeSend:function(){i.append(c.loadingDom)},success:function(e){var n=t.parseJSON(e.body);i.find(".qz-loading").remove(),n.cardgroup.length>0?(i.attr("data-pageIndex",d),s.appendCard("#qzCardListTopic",n.cardgroup),n.cardgroup.length<p&&(i.attr("data-moreload","close"),a.html("全部加载完成"))):"open"===i.attr("data-moreload")&&(i.attr("data-moreload","close"),a.html("全部加载完成"))}})}})},tabNav:function(){function a(){function a(){var a=r.offset().top,e=t("html").scrollTop();0===e&&(e=t("body").scrollTop()),e>=a?s.addClass("openQzNavFixed"):s.removeClass("openQzNavFixed")}function e(){var a=t("html"),e=a.height(),i=r.offset().top,n=a.scrollTop();0===n&&(n=t("body").scrollTop()),a.css("height",e),n>i&&t("html,body").animate({scrollTop:i},0)}function i(){var a=t("html");clearTimeout(n),n=setTimeout(function(){a.css("height","")},200)}var n,o=t(".qzNavFx"),s=t(".qzNavFxW"),r=t(".qzNavPos");a(),t(window).scroll(function(){a()}),o.find("a").on("click",function(){var a=t(this),n="#qzCardList";o.find("a").removeClass("cur"),a.addClass("cur"),t(n).html("").attr("data-pageIndex",0).attr("data-loading",!1),c.isCanLoading=!1,e(),t(n).getClub(function(){i()})})}t(".qzNavFx").length>0&&a()},pageGoto:function(){var a=t(".qz-card-list");a.on("click",".qzCard .qzZoneHref",function(){var a=t(this),e=a.data("href");window.open(e,"_blank")}),a.on("click",".qzZoneHref figure,.qzZoneHref a",function(t){t.stopPropagation()})},createCardComment:function(t){var a="";return a+='<li data-commid="'+t.commid+'"><a class="head">',a+='<img src="'+t.head+'" alt="'+t.name+'"></a>',a+='<div class="info qzBtnComment" data-clubcontentid="'+t.clubContentId+'" data-commid="'+t.commid+'" data-name="'+t.name+'"  data-userId="'+t.useId+'">',a+="<h5>"+t.name,t.reply&&(a+="<b>回复</b>"+t.reply),a+="</h5>",a+='<p class="time">'+t.replytime+"</p>",a+='<div class="context">',a+=t.context,a+="</div></div></li>"},createCommentReply:function(t,a){var e="";return e+='<div class="ic-item qzBtnCommentInner" data-clubcontentid="'+a+'" data-commid="'+t.commid+'" data-name="'+t.name+'" data-userid="'+t.useId+'"><a class="ici-name">'+t.name+"</a>",null!==t.reply&&(e+='<i class="ici-rpy">回复</i><a class="ici-name">'+t.reply+"</a>"),e+='<a class="ici-name">：&nbsp;</a><span class="ici-context">'+t.context+"</span></div>"},createCardCommentFull:function(a){var e="",i=this;return e+='<li data-commid="'+a.commid+'"',e+=a.replylike>=5?' class="with-hot-tags">':">",e+='<a class="head">',e+='<img src="'+a.head+'" alt="'+a.name+'"></a>',e+='<div class="info">',e+="<h5>"+a.name,a.editauth&&(e+='<img src="'+a.editauth+'" alt="编辑">'),e+='<a class="info-like">'+a.replylike+"</a>",e+="</h5>",e+='<div class="info-others"><span class="info-time">'+a.replytime+'</span><span class="info-device">来自'+a.replydevice+"</span></div>",e+='<div class="context qzBtnCommentInner" data-clubcontentid="'+a.clubContentId+'" data-commid="'+a.commid+'" data-name="'+a.name+'" data-userid="'+a.useId+'">',e+=a.context,e+="</div>",null!==a.reply&&(e+='<div class="info-comment">',t.each(a.reply,function(t,n){t<2&&(e+=i.createCommentReply(n,a.commid))}),a.reply.length>2&&(e+='<a class="info-comment-more">查看全部'+a.replycount+"条回复</a>"),e+="</div>"),e+="</div></li>"},createCardCommentList:function(t){var a="";return a+='<li data-commid="'+t.commid+'"><a class="head">',a+='<img src="'+t.head+'" alt="'+t.name+'"></a>',a+='<div class="info qzBtnCommentInner" data-clubcontentid="'+t.clubContentId+'" data-commid="'+t.commid+'" data-name="'+t.name+'"  data-userId="'+t.useId+'">',a+="<h5>"+t.name,t.reply&&(a+="<b>回复</b>"+t.reply),a+="</h5>",a+='<p class="time">'+t.replytime+"</p>",a+='<div class="context">',a+=t.context,a+="</div></div></li>"},insertCardComment:function(a,e,i){var n="";t.each(e,function(t,a){n+=s.createCardCommentFull(a)}),n+=i===!0?'<a class="club-card-comment-more clubCardCommentMore" data-clk="can">查看更多</a>':'<a class="club-card-comment-more">全部加载完成</a>',t(a).html(n)},appendCardComment:function(a,e,i){var n="";t.each(e,function(t,a){n+=s.createCardCommentFull(a)}),n+=i===!0?'<a class="club-card-comment-more clubCardCommentMore" data-clk="can">查看更多</a>':'<a class="club-card-comment-more">全部加载完成</a>',t(a).append(n)},createCardLike:function(t){var a="";return a+='<li data-likeid="'+t.likeid+'"><a class="head">',a+='<img src="'+t.head+'" alt="'+t.name+'"></a>',a+='<div class="name"><a>'+t.name+"</a></div>",a+="</div></li>"},insertCardLike:function(a,e){var i="";t.each(e,function(t,a){i+=s.createCardLike(a)}),t(a).html(i)},appendCardLike:function(a,e){var i="";t.each(e,function(t,a){i+=s.createCardLike(a)}),t(a).append(i)},openVideoPop:function(){function a(a){function e(){n.removeClass("cur"),setTimeout(function(){n.remove()},250)}var i="";i+='<div class="qz-video-pop qzVideoPop">',i+='<div class="qz-video-pop-con">',i+='<iframe height="100%" width="100%" src="http://player.youku.com/embed/'+a+'" frameborder=0 allowfullscreen></iframe>',i+="</div>",i+='<div class="qz-video-bar"><a class="qz-video-pop-close qzVideoPopClose"></div></a>',i+="</div>",t("body").append(i);var n=t(".qzVideoPop");setTimeout(function(){n.addClass("cur")},10),n.on("click",e),n.on("click","iframe",function(t){t.stopPropagation()})}t(".qzVideoPopBtn").on("click",function(){var e=t(this),i=e.data("href"),n="",o="http://v.youku.com/v_show/id_",c=i.indexOf(o)+o.length,s=i.indexOf("==.html");n=i.substring(c,s),a(n)})},createAllTopic:function(t){var a="";return a+='<li data-topicid="'+t.Id+'" data-topic="'+t.Title+'"><a href=commonApiUrl+"m/topic/'+t.Id+'"><b>'+t.Title+'</b><span><i class="num-in">0</i>人参与<i class="num-comm">0</i>条主题</span></a></li>'},allTopic:function(){function a(a){var e="";t.each(a,function(t,a){e+=s.createAllTopic(a)}),o.html(e),t("#qzAllTopicList li").allTopicJoinCount()}function i(a){var e="";t.each(a,function(t,a){e+=s.createAllTopic(a)}),o.append(e),t("#qzAllTopicList li").allTopicJoinCount()}function n(){var e=parseInt(o.attr("data-page"))+1,i={pageIndex:e,pageSize:l};t.ajax({type:"get",dataType:"jsonp",url:r,data:{jsondata:JSON.stringify(i)},success:function(t){o.attr({"data-page":e,"data-infiload":"open"}),a(t)}})}var o=t("#qzAllTopicList"),r=e+"club/api/gettopicall",l=o.attr("data-pageSize");o.length>0&&(n(),s.infiniteLoad("#qzAllTopicList",function(a,e){var n=t("#qzMain"),s=parseInt(o.attr("data-page"))+1,d={pageIndex:s,pageSize:l};t.ajax({type:"get",dataType:"jsonp",url:r,data:{jsondata:JSON.stringify(d)},beforeSend:function(){n.append(c.loadingDom)},success:function(t){n.find(".qz-loading").remove(),t.length>0?(e.attr("data-page",s),i(t)):"open"===e.attr("data-infiload")&&(e.attr("data-infiload","close"),n.append(c.loadedDom)),c.isCanLoading=!0}})}))},popBaiduShare:function(a,e){function i(){var t="";return t+='<div class="club-pop-baidu-mask clubPopBaidu clubPopBaiduClose"></div>',t+='<div class="club-pop-baidu-main clubPopBaidu">',t+='<div class="club-pop-baidu-head">分享</div>',t+='<div class="club-pop-baidu-body">',t+='<div class="club-pop-baidu-btns bdsharebuttonbox" data-tag="share_1"><a class="bds_tsina" data-cmd="tsina"></a><a class="bds_sqq" data-cmd="sqq"></a><a class="bds_qzone" data-cmd="qzone"></a><a class="bds_more" data-cmd="more"></a><a class="bds_count" data-cmd="count"></a></div>',t+="</div>",t+='<div class="club-pop-baidu-foot"><a class="clubPopBaiduClose">取消</a></div>',t+="</div>"}function n(){var i="http://bdimg.share.baidu.com/static/api/js/share.js?cdnversion="+~(-new Date/36e5);window._bd_share_config={common:{bdText:e,bdDesc:e,bdUrl:a},share:[{tag:"share_1",bdSize:32}]},"object"==typeof _bd_share_main?_bd_share_main.init():t.getScript(i)}function o(){var a=t(".clubPopBaidu");a.removeClass("cur"),setTimeout(function(){a.remove(),s.popCommon.close()},250)}function c(){var a=i();t("body").append(a),s.popCommon.open(),setTimeout(function(){t(".clubPopBaidu").addClass("cur")},50),t(".clubPopBaiduClose").on("click",function(){o()}),n()}var s=this;c()},globalBind:function(){var a=t("#qzMain"),e=this;a.on("click",".qzBtnShare",function(){var a=t(this),i=a.data("sharetext"),n=a.data("shareurl");e.popBaiduShare(n,i)})},main:function(){s.setRem(),s.addSwpOnce(),s.addComment(),s.addContext(),s.initPageTopic(),s.initPageContext(),s.tabNav(),s.infiniteLoad("#qzCardList",function(t,a){a.getClub()}),s.topicMore(),s.pageGoto(),s.allTopic(),t(window).resize(function(){s.setRem()}),s.globalBind()}};s.main(),t(document).ready(function(){t("#qzCardList").getClub(),t(".qzBtnLike").addLike(),t(".themeNum").joinCount(),t(".qz-nav-sort").change(function(a){a.preventDefault();var e=t(this).find("option:selected").attr("data-sort");t(this).attr("data-sort",e),t("#qzCardList").html("").attr("data-pageIndex",0).attr("data-loading",!1).getClub()})}),t.fn.fabuSubmit=function(a){return this.each(function(){var i=t(this),n=parseInt(i.find(".maxNum").html()),c=i.find(".mathIpt"),r=c.height(),l=parseInt(c.css("line-height")),d=15*l;c.textareaAutoHeight({minHeight:r,maxHeight:d}),i.on("focus",".mathIpt",function(){var a=t(this),e=a.attr("placeholder");a.attr("data-val",e).removeAttr("placeholder").parent().addClass("cur")}).on("blur",".mathIpt",function(){var a=t(this),e=a.attr("data-val");a.attr("placeholder",e).parent().removeClass("cur")}).on("keyup blur",".mathIpt",function(){var t=this.value.length;this.value=this.value.substr(0,n),i.find(".curNum").html(t),i.find(".fabu-num").css("display",t>0?"block":"")}),i.on("click",".qzPopSmt",function(){var i=t(".qz-pic-list-li:not(.temp)"),n=t(".fabuVideo"),c=t(".mathIpt").val(),r=""==c?t(".realIpt").html():c,l=t(".clubId").attr("data-selectClubId");if("true"!=t(this).attr("data-isclick")){t(this).attr("data-isclick",!0);var d="",p=i.length>9?9:i.length-1;if(p>0){d=[];for(var u=0;u<p;u++){var m=i.eq(u).find("img").attr("data-type"),f=i.eq(u).find("img").attr("src"),h=f.replace("tiny","small"),v=f.replace("tiny","origin"),g=f.replace("tiny","tinysquare");"gif"==m&&(v=v.replace(".jpg",".gif"));var b=i.eq(u).find("img").attr("data-height"),C=i.eq(u).find("img").attr("data-width");d.push({tiny:f,tinysquare:g,small:h,origin:v,height:b,width:C,imageType:m})}}var y="";if(n.length>0){var z="",q="",w="",x="",k="";void 0==n.attr("data-tit")?q="视频链接":(z=n.attr("data-vid"),q=n.attr("data-tit"),x=n.attr("data-img"),k=n.attr("data-sitename")),w=n.attr("data-url"),y={image:x,title:q,videoUrl:w,videoVid:z,siteName:k}}if(""==d&&""==y&&!o(r))return void alert("你还没有输入内容!");var I={content:r,images:d,videos:y,clubId:l,device:1};t.ajax({type:"post",dataType:"json",url:e+"club/api/addclubcontent",
data:{jsondata:JSON.stringify(I)},success:function(e){if("ok"==e.dataType){t(this).attr("data-isclick",!1),t(".mathIpt").val("");var i=s.createCard(e.cardgroup);t("#qzCardList").prepend(i),s.photoSwp(),t(".qzBtnLike").like(),t(".qzBtnLike").addLike(),t(".qzBtnComment").commentCount(),t("html,body").removeClass("hideScroll").animate({scrollTop:a},0),setTimeout(function(){t(".qzPop").remove()},250)}else alert("发布失败，请重试！")}})}})})},t.fn.selectPhoto=function(){return this.each(function(){t(this).bind("click",function(){t("#fileupload").trigger("click"),t("#fileupload").fileupload({dataType:"json",maxFileSize:"5000000",url:e+"uploadpic/index",done:function(a,i){var n=i.result;if("ok"==n.status){var o=t(".qz-pic-list-li .qz-img-remove").length+1;if(o>9)alert("最多只能传9张"),t(".qz-pic-list .temp:first").remove();else{9==o&&t(".qz-pic-list-add").parent().css("display","none");var c="<img src='"+n.tiny+"' data-original='"+n.original+"' data-height=\""+n.height+'" data-width="'+n.width+'" data-type="'+n.imageclass+"\"><a class='qz-img-remove'></a>";t(".qz-pic-list .temp:first").removeClass("temp").html(c)}t(".qz-pic-list .qz-img-remove").each(function(){t(this).unbind("click"),t(this).bind("click",function(){var a=t(this).parents(".pic").find("img").attr("data-original"),i=t(".qz-pic-list-li").not(":last").length;t(this).parent(".qz-pic-list-li").remove(),t.ajax({type:"get",dataType:"json",url:e+"uploadpic/delete?origin="+a,data:{},success:function(t){}}),i<9&&t(".qz-pic-list-add").parent().css("display","block")})})}else alert("包含不支持的文件格式"),t(".qz-pic-list .temp:first").remove()},change:function(a,e){var i=0,n=parseInt(t("#fileupload").attr("data-imagesize")),o=n/1024;t.each(e.files,function(a,e){if(e.size/1024>n&&i<=0)i+=1,alert("图片容量超过"+o+"MB，无法上传！");else if(e.size/1024<=n){var c='<div class="qz-pic-list-li temp"><img src="//image.gamersky.com/webimg15/user/club/pc/loading.gif" ></div>';t(".qz-pic-list-li:first").before(c)}})}})})})},t.fn.getClub=function(a){return this.each(function(){var e=t(this),o=t(".qzNavFx a.cur").attr("data-cfg"),r=n.listNavSetter[o].type,l=n.listNavSetter[o].sort,d=t(".clubId").attr("data-clubId"),p=t(".topic").attr("data-topic"),u=t(".topic").attr("data-topicId"),m=parseInt(e.attr("data-pageIndex"))+1,f=e.attr("data-pageSize"),h=e.attr("data-loading");if("true"!=h){e.attr("data-loading","true");var v=e.find(".qzCard").length,g=0,b=e.find(".qzCard:first").attr("data-cid");void 0!=b&&null!=b||(b=""),v>=50&&(g=v-50),b+=",",e.find(".qzCard:gt("+g+")").each(function(){b+=t(this).attr("data-cid")+","});var C={contentType:r,sort:l,pageIndex:m,pageSize:f,clubId:d,topic:p,topicId:u,excludeIds:b};e.attr("data-pageIndex",m);var y={jsondata:JSON.stringify(C)};i.getWapClubContext(y,function(i){var n=t.parseJSON(i.body);e.attr("data-loading","false"),e.find(".qz-loading").remove();var o=n.cardgroup.length;1==m&&0==o?e.html(c.loadnullDom).attr("data-infiload","close"):1==m&&o>0?(s.insertCard(e,n.cardgroup),o>=f?(e.attr("data-infiload","open"),c.isCanLoading=!0):(c.isCanLoading=!1,e.attr("data-infiload","close").append(c.loadedDom))):m>1&&o>0?(s.appendCard(e,n.cardgroup),e.attr("data-infiload","open"),c.isCanLoading=!0):e.attr("data-infiload","close").append(c.loadedDom),"function"==typeof a&&a&&a()},function(){t(".qz-loadnull,.qz-loaded").remove(),e.append(c.loadingDom)})}})},t.fn.like=function(){var a="";t(this).each(function(){""!=a&&(a+=","),a+=t(this).attr("data-clubcontentid")});var e={clubContentId:a},n={jsondata:JSON.stringify(e)};i.getLike(n,function(a){if("ok"==a.status){var e=t.parseJSON(a.body);t.each(e,function(a,e){t(".qzBtnLike[data-clubcontentid='"+e.Id+"']").each(function(){t(this).find("b").html(e.digg).attr("data-likecount",e.digg)})})}})},t.fn.addLike=function(e){return this.each(function(){var e=t(this);e.unbind("click"),e.click(function(n){n.preventDefault(),t(this).UserOnline(function(t){if("ok"==t.status||"dev"===a){var n=e.attr("data-clubcontentid"),o={clubContentId:n,fromDevice:1},c={jsondata:JSON.stringify(o)};i.addLike(c,function(t){if("err"==t.status)alert(t.body);else{var a=parseInt(e.find("b").html())+1;e.find("b").html(a)}})}})})})},t.fn.commentCount=function(){function a(){var a="";t(e).each(function(){""!=a&&(a+=","),a+=t(this).attr("data-clubcontentid")});var n={clubContentId:a},o={jsondata:JSON.stringify(n)};i.getCommentCount(o,function(a){if("ok"==a.status){var i=t.parseJSON(a.body);t.each(i,function(a,i){t(".qzBtnComment[data-clubcontentid='"+i.Id+"']").each(function(){var a=t(this);t(e).parents(".qzClComment").length>0||(a.html(i.commentCount),a.attr("data-commcount",i.commentCount),t("#qzCardList").length>0&&i.commentCount>0&&a.insertListComment())})})}})}var e=this;a()},t.fn.insertListComment=function(){function a(){var a=e.closest(".qzCard"),n="",o=1,c=e.data("clubcontentid"),r={clubContentId:c,pageIndex:o,pageSize:10},l={jsondata:JSON.stringify(r)};i.getWapClubComment(l,function(i){var o=t.parseJSON(i.body);"ok"===o.dataType&&"ok"!=e.attr("data-isinsert")&&(e.attr("data-isinsert","ok"),n+='<div class="qz-comment-inlist"><ul>',t.each(o.commlist,function(t,a){t<3&&(n+=s.createCardCommentList(a))}),n+="</ul></div>",t(n).insertBefore(a.find("footer")))})}var e=t(this);"open"===n.innerCommentState&&a()},t.fn.joinCount=function(){var a="";t(this).each(function(){""!=a&&(a+=","),a+=t(this).attr("data-topic")});var i={topic:a};t.ajax({type:"get",dataType:"jsonp",url:e+"club/api/getjoinarraycount",data:{jsondata:JSON.stringify(i)},success:function(a){"ok"==a.status&&t.each(a.result,function(a,e){t(".themeNum[data-topic='"+e.topic+"']").each(function(){t(this).find(".join").html(e.join+"人"),t(this).find(".theme").html(e.clubContent),t(this).find("span i").html(e.clubContent)})})}})},t.fn.allTopicJoinCount=function(){var a="";t(this).each(function(){""!=a&&(a+=","),a+=t(this).attr("data-topic")});var i={topic:a};t.ajax({type:"get",dataType:"jsonp",url:e+"club/api/getjoinarraycount",data:{jsondata:JSON.stringify(i)},success:function(a){"ok"==a.status&&t.each(a.result,function(a,e){t("#qzAllTopicList li[data-topic='"+e.topic+"']").each(function(){t(this).find(".num-in").html(e.join),t(this).find(".num-comm").html(e.clubContent)})})}})},t.fn.addComment=function(a){var i=t(this);if("true"!=i.attr("data-isclick")){i.attr("data-isclick",!0);var n=t.trim(i.parent().siblings(".pop-con").find(".mathIpt").val()),o=i.data("userid"),c=i.data("clubcontentid"),r=i.data("commentid");if(""==n)return void alert("评论不能为空！");if(n.length>=5e3)return void alert("评论不能超过5000个字符！");var l={userId:o,clubContentId:c,content:n,replyId:r,fromDevice:1};t.ajax({type:"post",dataType:"json",url:e+"club/api/addcomment",data:{jsondata:JSON.stringify(l)},success:function(e){if("ok"==e.dataType){i.attr("data-isclick",!1);var n=t("#qzClComment");if(n.length>0){var o=s.createCardComment(e.commlist);0==n.find("li").length?n.html(o):n.prepend(o);var r=parseInt(t(".commentNum i,.qzBtnComment").html())+1;t(".commentNum i,#qzCardContext .btn-comment").html(r)}else t(".qzBtnComment[data-clubcontentid="+c+"]").html("1").attr("data-commcount",1),s.initPageContext();t(".qzPop").removeClass("cur"),t("html,body").removeClass("hideScroll").animate({scrollTop:a},0),setTimeout(function(){t(".qzPop").remove()},250)}else alert(e.body)}})}},t.fn.UserOnline=function(i){t.ajax({type:"GET",dataType:"jsonp",url:e+"api/logincheck",success:function(e){"dev"===a?i(e):"ok"!==e.status?(t(".ymw-loginpop-btns").insertYmwLoginPop(),t(".ymw-loginpop-btns").QZloginForm()):i(e)}})},t.fn.QZloginForm=function(){var a=t(this);a.on("click","#qqLogin",function(t){t.preventDefault();var a=window.location.href;window.location.href=e+"oauth/authorizelogin?authorizetype=qq&returnUrl="+encodeURI(a)}).on("click","#sinaLogin",function(t){t.preventDefault();var a=window.location.href;window.location.href=e+"oauth/authorizelogin?authorizetype=sina&returnUrl="+encodeURI(a)})},t.fn.insertYmwLoginPop=function(){t(".gsZpPopLoginClose").show(),t(".gs_zp_pop_login").show(),t(".gsZpPopLoginClose").on("click",function(){t(".gs_zp_pop_login").hide(),t(".gsZpPopLoginClose").hide()})},t.fn.removeTarget=function(){return this.each(function(){t(this).find("a").attr("target","_self")})}}(jQuery);
//# sourceMappingURL=qz.wap.min.js.map
