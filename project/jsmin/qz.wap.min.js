!function(t){var a="dev",e={getWapCardComment:function(a,e,i){var n="./data/fake.comment.page1.json";t.ajax({type:"get",dataType:"json",url:n,data:a,beforeSend:function(){"function"==typeof i&&i()},success:function(t){"function"==typeof e&&e(t)},error:function(t){console.log(t)}})},getWapCardContext:function(a,e,i){var n="http://192.168.0.100:9014/apis/club/api/getwapcardcontext";t.ajax({type:"get",dataType:"json",url:n,data:a,beforeSend:function(){"function"==typeof i&&i()},success:function(t){"function"==typeof e&&e(t)},error:function(t){console.log(t)}})},getWapClubContext:function(a,e,i){var n="http://192.168.0.100:9014/apis/club/api/getwapclubcontent";t.ajax({type:"get",dataType:"json",url:n,data:a,beforeSend:function(){"function"==typeof i&&i()},success:function(t){"function"==typeof e&&e(t)},error:function(t){console.log(t)}})},getCommentCount:function(a,e,i){var n="http://192.168.0.100:9014/apis/club/api/getcommentcount";t.ajax({type:"get",dataType:"jsonp",url:n,data:a,beforeSend:function(){"function"==typeof i&&i()},success:function(t){"function"==typeof e&&e(t)},error:function(t){console.log(t)}})},getWapClubComment:function(a,e,i){var n="http://192.168.0.100:9014/apis/club/api/getwapclubcomment";t.ajax({type:"get",dataType:"json",url:n,data:a,beforeSend:function(){"function"==typeof i&&i()},success:function(t){"function"==typeof e&&e(t)},error:function(t){console.log(t)}})},getwapclubuserlike:function(a,e,i){var n="http://192.168.0.100:9014/apis/club/api/getwapclubuserlike";t.ajax({type:"get",dataType:"json",url:n,data:a,beforeSend:function(){"function"==typeof i&&i()},success:function(t){"function"==typeof e&&e(t)},error:function(t){console.log(t)}})},getLike:function(a,e,i){var n="http://192.168.0.100:9014/apis/club/api/getlike";t.ajax({type:"get",dataType:"jsonp",url:n,data:a,beforeSend:function(){"function"==typeof i&&i()},success:function(t){"function"==typeof e&&e(t)},error:function(t){console.log(t)}})},addLike:function(a,e,i){var n="http://192.168.0.100:9014/apis/club/api/addlike";t.ajax({type:"get",dataType:"jsonp",url:n,data:a,beforeSend:function(){"function"==typeof i&&i()},success:function(t){"function"==typeof e&&e(t)},error:function(t){console.log(t)}})},getWapCardCommentPage1:function(a,e,i){var n=JSON.parse(a.jsondata),o=n.pageIndex,c=n.sort,s="./data/fake.comment.page1.json";0===c&&1===o?s="./data/fake.comment.page1.oldest.json":0===c&&2===o?s="./data/fake.comment.page2.oldest.json":1===c&&2===o&&(s="./data/fake.comment.page2.json"),t.ajax({type:"get",dataType:"json",url:s,data:a,beforeSend:function(){"function"==typeof i&&i()},success:function(t){"function"==typeof e&&e(t)},error:function(t){console.log(t)}})},getWapCardCommentPageHot:function(a,e,i){var n="./data/fake.comment.hot.json";t.ajax({type:"get",dataType:"json",url:n,data:a,beforeSend:function(){"function"==typeof i&&i()},success:function(t){"function"==typeof e&&e(t)},error:function(t){console.log(t)}})},getWapCardCommentReply:function(a,e,i){var n=JSON.parse(a.jsondata),o=n.replyPageIndex,c="./data/fake.comment.reply.page1.json";3===o&&(c="./data/fake.comment.reply.page2.json"),t.ajax({type:"get",dataType:"json",url:c,data:a,beforeSend:function(){"function"==typeof i&&i()},success:function(t){"function"==typeof e&&e(t)},error:function(t){console.log(t)}})}},i={listNavSetter:{"new":{sort:1,type:0},hot:{sort:2,type:0},best:{sort:1,type:1}},innerCommentState:"close"},n=function(t){return"undefined"!=typeof t&&t.replace(/(^\s*)|(\s*$)/g,"")};t.fn.extend({textareaAutoHeight:function(a){this._options={minHeight:0,maxHeight:1e3},this.init=function(){for(var e in a)this._options[e]=a[e];0==this._options.minHeight&&(this._options.minHeight=parseFloat(t(this).height()));for(var e in this._options)null==t(this).attr(e)&&t(this).attr(e,this._options[e]);t(this).keyup(this.resetHeight).change(this.resetHeight).focus(this.resetHeight)},this.resetHeight=function(){var a=parseFloat(t(this).attr("minHeight")),e=parseFloat(t(this).attr("maxHeight"));t.browser.msie||t(this).height(0);var i=parseFloat(this.scrollHeight);i=i<a?a:i>e?e:i,t(this).height(i).scrollTop(i),t(this).css("overflow-y",i>=e?"scroll":"hidden")},this.init()}});var o={isCanLoading:!0,loadingDom:'<div class="qz-loading">正在加载</div>',loadedDom:'<div class="qz-loaded">全部加载完成</div>',loadnullDom:'<div class="qz-loadnull">还没有内容</div>'},c={setRem:function(){var a=t(window).width();a>=640&&(a=640),t("html").css({"font-size":a/6.4+"px"})},popCommon:{open:function(){t("html").addClass("hideScroll"),t(".ymw-backtotop").css("display","none")},close:function(){t("html").removeClass("hideScroll"),t(".ymw-backtotop").css("display","block")}},createCard:function(a){var e="";if(e+='<div class="qz-card qzCard" data-cid="'+a.cardid+'">',e+='<header><a class="head"><img src="'+a.head+'" alt="head"></a>',e+='<div class="info"><h5>',e+="<a>"+a.user+"</a>",n(a.vauth)&&(e+='<img src="'+a.vauth+'">'),e+="</h5><p>",e+='<span class="time">'+a.createtime+"</span>",e+="</p>",e+="</div>",a.spectop!==!0&&a.specvalue!==!0||(e+='<div class="spec-icons">',a.spectop===!0&&(e+='<a class="spec-top">置顶</a>'),a.specvalue===!0&&(e+='<a class="spec-value">精</a>'),e+="</div>"),e+="</header>",e+='<section class="detail qzZoneHref" data-href="'+a.url+'">',e+='<div class="content">',a.isVideo?(e+=a.text,e+="<a href="+a.video.src+' class="link-video">'+a.video.videoTitle+"</a>"):e+=a.text,e+="</div>",a.piclist.length>0&&(e+='<div class="media-pic-list"><div class="clearfix qz-figs qzPicPswp">',t.each(a.piclist,function(t,a){e+='<figure class="qzPicPswpBtn',"gif"===a.ext?(e+=' gif"',a.large=a.origin):"long"===a.ext&&(e+=' long"'),e+='"><a data-picType="'+a.ext+'" data-origin="'+a.origin+'"  data-large="'+a.large+'" data-size="'+a.size+'"><img src="'+a.url+'"></a></figure>'}),e+="</div></div>"),void 0!=a.picbig.large){a.picbig.large=a.picbig.url;var i="";e+='<div class="qzPicPswp media-pic',"gif"===a.picbig.ext?(i=" gif",a.picbig.large=a.picbig.origin):"long"===a.picbig.ext&&(i=" long"),e+='"><figure class="'+i+'"><a  data-picType="'+a.picbig.ext+'" data-origin="'+a.picbig.origin+'" data-large="'+a.picbig.large+'" data-size="'+a.picbig.size+'"><img src="'+a.picbig.url+'" class="qzPicPswpBtn"></a></figure></div>'}return a.isVideo&&(e+='<div class="media-video">',e+='<a class="qzVideoPopBtn" data-href="'+a.video.src+'"><img src="'+a.video.pic+'" alt=""></a></div>'),e+="</section>",a.fromUrl&&(e+='<div class="from">来自：<a href="'+a.fromUrl+'" >'+a.from+"</a></div>"),e+="<footer>",e+='<a class="btn-share qzBtnShare" data-shareid="'+a.cardid+'">分享</a>',e+='<span></span><a class="btn-comment qzBtnComment" data-commcount=""  data-clubcontentid="'+a.cardid+'"   data-href="'+a.url+'">0</a>',e+='<span></span><a class="btn-like qzBtnLike" data-likecount="" data-clubcontentid="'+a.cardid+'" ><i></i><b>0</b></a>',e+="</footer>",e+="</div>",e+="",e+=""},addSwpOnce:function(){var a='<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button><a target="_blank" class="pswp__button pswpBtnOrigin pswp__single-tap" title="查看原图"></a> <button class="pswp__button pswp__button--share" title="Share"></button> <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button> <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button> <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div>';t("body").append(a)},photoSwp:function(){var a=function(a){for(var e=function(t){for(var a,e,i,n,o=t.childNodes,c=o.length,s=[],r=0;r<c;r++)a=o[r],1===a.nodeType&&(e=a.children[0],i=e.getAttribute("data-size").split("x"),n={src:e.getAttribute("data-large"),w:parseInt(i[0],10),h:parseInt(i[1],10),ori:e.getAttribute("data-origin"),picType:e.getAttribute("data-picType")},a.children.length>1&&(n.title=a.children[1].innerHTML),e.children.length>0&&(n.msrc=e.children[0].getAttribute("src")),n.el=a,s.push(n));return s},i=function d(t,a){return t&&(a(t)?t:d(t.parentNode,a))},n=function(t){t=t||window.event,t.preventDefault?t.preventDefault():t.returnValue=!1;var a=t.target||t.srcElement,e=i(a,function(t){return t.tagName&&"FIGURE"===t.tagName.toUpperCase()});if(e){for(var n,c=e.parentNode,s=e.parentNode.childNodes,r=s.length,d=0,l=0;l<r;l++)if(1===s[l].nodeType){if(s[l]===e){n=d;break}d++}return n>=0&&o(n,c),!1}},o=function(a,i,n,o){function c(a){t(".pswpBtnOrigin").attr("href",d[a].ori)}var s,r,d,l=t(".pswp")[0];if(d=e(i),r={shareEl:!1,fullscreenEl:!1,zoomEl:!1,bgOpacity:1,showHideOpacity:0,galleryUID:i.getAttribute("data-pswp-uid"),history:!1,tapToClose:!0,getThumbBoundsFn:function(t){var a=d[t].el.getElementsByTagName("img")[0],e=window.pageYOffset||document.documentElement.scrollTop,i=a.getBoundingClientRect();return{x:i.left,y:i.top+e,w:i.width}}},o)if(r.galleryPIDs){for(var p=0;p<d.length;p++)if(d[p].pid==a){r.index=p;break}}else r.index=parseInt(a,10)-1;else r.index=parseInt(a,10);isNaN(r.index)||(n&&(r.showAnimationDuration=0),s=new PhotoSwipe(l,PhotoSwipeUI_Default,d,r),s.init(),s.listen("initialZoomIn",function(){c(s.getCurrentIndex()),t(".pswp").animate({opacity:1},333)}),s.listen("initialZoomOut",function(){t(".pswp").animate({opacity:0},200)}),s.listen("afterChange",function(){c(s.getCurrentIndex())}))},c=document.querySelectorAll(a),s=0,r=c.length;s<r;s++)c[s].setAttribute("data-pswp-uid",s+1),c[s].onclick=n};a(".qzPicPswp")},insertCard:function(a,e){var i="";t.each(e,function(t,a){i+=c.createCard(a)}),t(a).html(i),t(".qzBtnLike").like(),t(".qzBtnLike").addLike(),t(".qzCard .content").removeTarget(),t(".qzBtnComment").commentCount(),c.photoSwp(),c.openVideoPop()},appendCard:function(a,e){var i="";t.each(e,function(t,a){i+=c.createCard(a)}),t(a).append(i),t(".qzBtnLike").like(),t(".qzBtnLike").addLike(),t(".qzCard .content").removeTarget(),t(".qzBtnComment").commentCount(),c.photoSwp(),c.openVideoPop()},addContext:function(){function e(a){function e(){s.find(".realIpt").on("input",function(){s.find(".mathIpt").val(s.find(".realIpt").val());var t=s.find(".mathIpt")[0].scrollHeight;s.find(".realIpt").css("height",t)})}function i(){s.removeClass("cur"),t("html,body").removeClass("hideScroll").animate({scrollTop:a},0),setTimeout(function(){s.remove()},250)}var o=t(".topic").attr("data-topic");""==o&&(o=t(".topic").attr("data-selecttopic"));var c="";c+='<div class="qz-pop qzPop">',c+='<header>发布内容<a class="qz-pop-close qzPopClose"></a><a class="qz-pop-smt qzPopSmt">发布</a></header>',c+='<div class="pop-con">',c+='<div class="pop-srl"><textarea class="realIpt" placeholder="分享你的游戏心得...">',n(o)&&(c+=o),c+='</textarea > <textarea class="mathIpt" rows="3"></textarea></div > ',c+='<div class="clearfix qz-pic-list">',c+='<div class="qz-pic-list-li"><label for="qzSelectPhoto" class="qz-pic-list-add"></label></div>',c+="</div>",c+='<input id="fileupload" data-imagesize="5120"  type="file" style="display:none" name="files" method="POST" multiple="">',c+="</div>",c+='<footer><label for="qzSelectPhoto" class="qz-upload-pic qzUploadPic">图片</label><select class="qz-pop-sel">',c+="</select>",c+="</footer></div>",t("body").append(c);var s=t(".qzPop"),r=t(".clubList").html();t(".qz-pop-sel").html(r),t(".qz-pic-list-add,.qzUploadPic").selectPhoto(),t(".qz-pop-sel").change(function(a){a.preventDefault();var e=t(this).find("option:selected").val();t(".clubId").attr("data-selectclubid",e)}),setTimeout(function(){s.addClass("cur")},10),e(),t(".qzPopClose").on("click",i),s.fabuSubmit(a)}t("#qzMain").on("click",".qzBtnContext",function(){t(this).UserOnline(function(i){if("ok"==i.status||"dev"===a){var n=t("html").scrollTop();0===n&&(n=t("body").scrollTop()),setTimeout(function(){t("html,body").addClass("hideScroll")},300),e(n)}})})},addComment:function(){function e(a,e,i,n,o){function c(){l.find(".realIpt").on("input",function(){l.find(".mathIpt").val(l.find(".realIpt").val());var t=l.find(".mathIpt")[0].scrollHeight;l.find(".realIpt").css("height",t)})}function s(){l.removeClass("cur"),t("html,body").removeClass("hideScroll").animate({scrollTop:a},0),setTimeout(function(){l.remove()},250)}var r="",d=n?"回复 "+n+"：":"我来说两句...";r+='<div class="qz-pop qzPop">',r+='<header>评论<a class="qz-pop-close qzPopClose"></a><a data-userId="'+o+'" data-clubContentId="'+e+'"  data-commentId="'+i+'" class="qz-pop-smt qzPopSmt">发布</a></header>',r+='<div class="pop-con"><div class="pop-srl"><textarea class="realIpt" placeholder="'+d+'"></textarea><textarea class="mathIpt" rows="3"></textarea></div></div>',r+="</div>",t("body").append(r);var l=t(".qzPop");setTimeout(function(){l.addClass("cur")},10),c(),t(".qzPopClose").on("click",s),t(".qzPopSmt").on("click",function(){l.find(".realIpt").val();t(this).addComment(a)})}function i(i){i.UserOnline(function(n){if("ok"==n.status||"dev"===a){var o=t("html").scrollTop(),c=i.data("clubcontentid"),s=(i.data("commcount"),i.data("href"),i.data("userid")),r=i.data("commid"),d=i.attr("data-name");0===o&&(o=t("body").scrollTop()),setTimeout(function(){t("html,body").addClass("hideScroll")},300),e(o,c,r,d,s)}})}t("#qzMain").on("click",".qzBtnComment",function(){var i=t(this),n=i.data("commcount"),o=i.data("href");return n>0&&t("#qzCardContext").length<1?(window.open(o,"_blank"),!1):void i.UserOnline(function(n){if("ok"==n.status||"dev"===a){var o=t("html").scrollTop(),c=i.data("clubcontentid"),s=i.data("commcount"),r=i.data("userid"),d=i.data("commid"),l=i.attr("data-name");if(t("#qzCardContext").length>0)return 0===o&&(o=t("body").scrollTop()),setTimeout(function(){t("html,body").addClass("hideScroll")},300),e(o,c,d,l,r),!1;0!==s&&""!=s||(0===o&&(o=t("body").scrollTop()),setTimeout(function(){t("html,body").addClass("hideScroll")},300),e(o,c,d,l,r))}})}),t("#qzMain").on("click",".qzBtnCommentInner",function(){var a=t(this);i(a)})},initPageTopic:function(){var a="#qzCardListTopic",e=t(a);if(e.length>0){var i="http://192.168.0.100:9014/apis/club/api/GetWapClubContentByTopic",n=t(".clubId").attr("data-selectClubId"),s=t(".topic").attr("data-topic"),r={clubId:n,topicTitle:s,pageIndex:0};t.ajax({type:"post",dataType:"json",url:i,data:{jsondata:JSON.stringify(r)},beforeSend:function(){e.append(o.loadingDom)},success:function(i){var n=t.parseJSON(i.body);"ok"===n.dataType&&n.cardgroup.length>0?(t(".comeFrom").html(n.cardgroup[0].from),e.attr("data-page",n.page),e.attr("data-moreload","open"),c.insertCard(a,n.cardgroup),n.count<=1&&t(".qzCardMoreBtn").remove(),t(".qz-rem").css("display","block")):e.html(o.loadnullDom)}})}},initPageContext:function(){var a="#qzCardContext",i=t(a);if(i.length>0){var n={clubContentId:i.attr("data-cid")},s={jsondata:JSON.stringify(n)};e.getWapCardContext(s,function(e){var n=t.parseJSON(e.body);"ok"===n.dataType?(i.attr("data-page",n.page),c.insertCard(a,n.cardgroup)):i.html(o.loadnullDom)},function(){i.append(o.loadingDom)});var r={vmBuild:function(){var a=t("#clubCardComment").data("cid"),i={template:'                                <div class="info-comment">                                    <div v-for="item in rld" class="ic-item qzBtnCommentInner" :data-clubcontentid="cid" :data-commid="item.commid" :data-name="item.name" :data-userid="item.useId">                                        <a class="ici-name">{{item.name}}</a>                                        <i v-if="item.reply" class="ici-rpy">回复</i>                                        <a v-if="item.reply" class="ici-name">{{item.reply}}</a>                                        <a class="ici-name">：&nbsp;</a><span class="ici-context">{{item.context}}</span>                                    </div>                                    <a class="info-comment-more" v-if="more" :class="moregray?\'disable\':\'\'" @click="moreBtn">{{moretxt}}</a>                                </div>                            ',data:function(){return{more:!1,moretxt:"查看全部"+(this.count-2)+"条回复",moregray:!1,page:2,pagesize:10}},props:["rld","cid","count"],mounted:function(){this.count>2&&(this.more=!0)},methods:{moreBtn:function(){(this.page-2)*this.pagesize<=this.count-2&&this.getListData()},getListData:function(){var t=this,i={clubContentId:a,pageIndex:1,pageSize:1,sort:0,replyPageIndex:t.page,replyPageSize:t.pagesize},n={jsondata:JSON.stringify(i)};e.getWapCardCommentReply(n,function(a){var e=a.body;if("ok"===e.dataType){var i=e.commlist[0].reply;t.rld=t.rld.concat(i),t.pagesize*(t.page-1)>=t.count?(t.moretxt="全部加载完成",t.moregray=!0):t.moretxt="查看剩余"+(t.count-t.pagesize*(t.page-1)-2)+"条回复",t.page++}},function(){t.moretxt="加载中..."})}}},n={template:'                                <li>                                    <a class="head"><img :src="item.head" :alt="item.name"></a>                                    <div class="info">                                        <h5>{{item.name}}<a class="info-like">{{item.replylike}}</a></h5>                                        <div class="info-others"><span class="info-time">{{item.replytime}}</span></div>                                        <div class="context qzBtnCommentInner" :data-clubcontentid="item.clubContentId" :data-commid="item.commid" :data-name="item.name" :data-userid="item.useId" v-html="item.context"></div>                                        <comm-line v-if="item.reply" :count="item.replycount" :cid="item.clubContentId" :rld="item.reply"></comm-line>                                     </div>                                </li>                            ',props:["item"],components:{CommLine:i}},o={template:'                                <div v-if="hotshow" class="club-card-comment-list-hot">                                    <h4>热门评论</h4>                                    <ul class="club-card-comment-list">                                        <comm-li v-for="item in lists" :item="item"></comm-li>                                    </ul>                                </div>                            ',data:function(){return{page:1,lists:[],hotshow:!1}},created:function(){var t=this,i={clubContentId:a,pageIndex:t.page,pageSize:1e3},n={jsondata:JSON.stringify(i)};e.getWapCardCommentPageHot(n,function(a){var e=a.body;"ok"===e.dataType&&(t.hotshow=!0,t.lists=e.commlist)})},components:{CommLine:i,CommLi:n}},c={template:'                                <div v-if="allshow" class="club-card-comment-list-all">                                    <nav><a v-for="(nav,idx) in navs" :class="nav.sort===sort?\'cur\':\'\'" @click="sortChange(idx)">{{nav.txt}}</a></nav>                                    <ul class="club-card-comment-list">                                        <comm-li v-for="(item,idx) in navs[sort].list" :item="item" :key="idx"></comm-li>                                    </ul>                                    <a class="club-card-comment-more" @click="getMore" v-html="moreState[navs[sort].more]"></a>                                </div>                            ',data:function(){return{sort:1,eachnum:10,moreState:["查看更多","全部加载完成","<i></i>正在加载"],navs:[{txt:"最早",sort:0,page:1,pageall:0,more:1,list:[]},{txt:"最新",sort:1,page:1,pageall:0,more:1,list:[]}],lists:[],allshow:!1}},created:function(){this.getList(this.navs[this.sort].page)},components:{CommLine:i,CommLi:n},methods:{getList:function(t){var i=this,n={clubContentId:a,pageIndex:t,pageSize:i.eachnum,sort:i.sort},o={jsondata:JSON.stringify(n)};e.getWapCardCommentPage1(o,function(t){var a=t.body;"ok"===a.dataType&&(i.allshow=!0,i.navs[i.sort].pageall=a.count,i.navs[i.sort].list=i.navs[i.sort].list.concat(a.commlist),i.navs[i.sort].page*i.eachnum<a.count?i.navs[i.sort].more=0:i.navs[i.sort].more=1)},function(){i.navs[i.sort].more=2})},sortChange:function(t){var a=this;a.sort=t,a.navs[t].list.length<1&&a.getList(a.navs[a.sort].page)},getMore:function(){function t(){a.getList(++a.navs[a.sort].page)}var a=this;a.navs[a.sort].page*a.eachnum<a.navs[a.sort].pageall&&t()}}},s={template:'<div class="club-card-comment-box"><comm-hot></comm-hot><comm-all></comm-all></div>',components:{CommHot:o,CommAll:c}};new Vue({el:"#clubCardComment",components:{VmMain:s}})},init:function(){this.vmBuild()}};r.init()}},infiniteLoad:function(a,e){function i(){var i=t(a);"open"===i.attr("data-infiload")&&"function"==typeof e&&e(a,i)}function n(){var a=t("html").scrollTop(),e=t(document).height(),n=t(window).height();0===a&&(a=t("body").scrollTop()),a>e-n-20&&a>n-e&&o.isCanLoading===!0&&(o.isCanLoading=!1,i())}t(a).length>0&&t(window).scroll(function(){n()})},topicMore:function(){var a=t(".qzCardMoreBtn");a.on("click",function(){var e=t("#qzCardListTopic");if(e.length>0&&"open"===e.attr("data-moreload")){var i="http://192.168.0.100:9014/apis/club/api/GetWapClubContentByTopic",n=t(".clubId").attr("data-selectClubId"),s=t(".topic").attr("data-topic"),r=e.find(".qzCard").attr("data-cid"),d=parseInt(e.attr("data-pageIndex")),l=0==d?9:10;d=0==d?1:d+1;var p={clubId:n,topicTitle:s,excludeclubContentId:r,pageIndex:d,pageSize:l};t.ajax({type:"get",dataType:"json",url:i,data:{jsondata:JSON.stringify(p)},beforeSend:function(){e.append(o.loadingDom)},success:function(i){var n=t.parseJSON(i.body);e.find(".qz-loading").remove(),n.cardgroup.length>0?(e.attr("data-pageIndex",d),c.appendCard("#qzCardListTopic",n.cardgroup),n.cardgroup.length<l&&(e.attr("data-moreload","close"),a.html("全部加载完成"))):"open"===e.attr("data-moreload")&&(e.attr("data-moreload","close"),a.html("全部加载完成"))}})}})},tabNav:function(){function a(){function a(){var a=r.offset().top,e=t("html").scrollTop();0===e&&(e=t("body").scrollTop()),e>=a?s.addClass("openQzNavFixed"):s.removeClass("openQzNavFixed")}function e(){var a=t("html"),e=a.height(),i=r.offset().top,n=a.scrollTop();0===n&&(n=t("body").scrollTop()),a.css("height",e),n>i&&t("html,body").animate({scrollTop:i},0)}function i(){var a=t("html");clearTimeout(n),n=setTimeout(function(){a.css("height","")},200)}var n,c=t(".qzNavFx"),s=t(".qzNavFxW"),r=t(".qzNavPos");a(),t(window).scroll(function(){a()}),c.find("a").on("click",function(){var a=t(this),n="#qzCardList";c.find("a").removeClass("cur"),a.addClass("cur"),t(n).html("").attr("data-pageIndex",0).attr("data-loading",!1),o.isCanLoading=!1,e(),t(n).getClub(function(){i()})})}t(".qzNavFx").length>0&&a()},pageGoto:function(){var a=t(".qz-card-list");a.on("click",".qzCard .qzZoneHref",function(){var a=t(this),e=a.data("href");window.open(e,"_blank")}),a.on("click",".qzZoneHref figure,.qzZoneHref a",function(t){t.stopPropagation()})},createCardComment:function(t){var a="";return a+='<li data-commid="'+t.commid+'"><a class="head">',a+='<img src="'+t.head+'" alt="'+t.name+'"></a>',a+='<div class="info qzBtnComment" data-clubcontentid="'+t.clubContentId+'" data-commid="'+t.commid+'" data-name="'+t.name+'"  data-userId="'+t.useId+'">',a+="<h5>"+t.name,t.reply&&(a+="<b>回复</b>"+t.reply),a+="</h5>",a+='<p class="time">'+t.replytime+"</p>",a+='<div class="context">',a+=t.context,a+="</div></div></li>"},createCommentReply:function(t,a){var e="";return e+='<div class="ic-item qzBtnCommentInner" data-clubcontentid="'+a+'" data-commid="'+t.commid+'" data-name="'+t.name+'" data-userid="'+t.useId+'"><a class="ici-name">'+t.name+"</a>",null!==t.reply&&(e+='<i class="ici-rpy">回复</i><a class="ici-name">'+t.reply+"</a>"),e+='<a class="ici-name">：&nbsp;</a><span class="ici-context">'+t.context+"</span></div>"},createCardCommentFull:function(a){var e="",i=this;return e+='<li data-commid="'+a.commid+'"',e+=a.replylike>=5?' class="with-hot-tags">':">",e+='<a class="head">',e+='<img src="'+a.head+'" alt="'+a.name+'"></a>',e+='<div class="info">',e+="<h5>"+a.name,a.editauth&&(e+='<img src="'+a.editauth+'" alt="编辑">'),e+='<a class="info-like">'+a.replylike+"</a>",e+="</h5>",e+='<div class="info-others"><span class="info-time">'+a.replytime+'</span><span class="info-device">来自'+a.replydevice+"</span></div>",e+='<div class="context qzBtnCommentInner" data-clubcontentid="'+a.clubContentId+'" data-commid="'+a.commid+'" data-name="'+a.name+'" data-userid="'+a.useId+'">',e+=a.context,e+="</div>",null!==a.reply&&(e+='<div class="info-comment">',t.each(a.reply,function(t,n){t<2&&(e+=i.createCommentReply(n,a.commid))}),a.reply.length>2&&(e+='<a class="info-comment-more">查看全部'+a.replycount+"条回复</a>"),e+="</div>"),e+="</div></li>"},createCardCommentList:function(t){var a="";return a+='<li data-commid="'+t.commid+'"><a class="head">',a+='<img src="'+t.head+'" alt="'+t.name+'"></a>',a+='<div class="info qzBtnCommentInner" data-clubcontentid="'+t.clubContentId+'" data-commid="'+t.commid+'" data-name="'+t.name+'"  data-userId="'+t.useId+'">',a+="<h5>"+t.name,t.reply&&(a+="<b>回复</b>"+t.reply),a+="</h5>",a+='<p class="time">'+t.replytime+"</p>",a+='<div class="context">',a+=t.context,a+="</div></div></li>"},insertCardComment:function(a,e,i){var n="";t.each(e,function(t,a){n+=c.createCardCommentFull(a)}),n+=i===!0?'<a class="club-card-comment-more clubCardCommentMore" data-clk="can">查看更多</a>':'<a class="club-card-comment-more">全部加载完成</a>',t(a).html(n)},appendCardComment:function(a,e,i){var n="";t.each(e,function(t,a){n+=c.createCardCommentFull(a)}),n+=i===!0?'<a class="club-card-comment-more clubCardCommentMore" data-clk="can">查看更多</a>':'<a class="club-card-comment-more">全部加载完成</a>',t(a).append(n)},createCardLike:function(t){var a="";return a+='<li data-likeid="'+t.likeid+'"><a class="head">',a+='<img src="'+t.head+'" alt="'+t.name+'"></a>',a+='<div class="name"><a>'+t.name+"</a></div>",a+="</div></li>"},insertCardLike:function(a,e){var i="";t.each(e,function(t,a){i+=c.createCardLike(a)}),t(a).html(i)},appendCardLike:function(a,e){var i="";t.each(e,function(t,a){i+=c.createCardLike(a)}),t(a).append(i)},openVideoPop:function(){function a(a){function e(){n.removeClass("cur"),setTimeout(function(){n.remove()},250)}var i="";i+='<div class="qz-video-pop qzVideoPop">',i+='<div class="qz-video-pop-con">',i+='<iframe height="100%" width="100%" src="http://player.youku.com/embed/'+a+'" frameborder=0 allowfullscreen></iframe>',i+="</div>",i+='<div class="qz-video-bar"><a class="qz-video-pop-close qzVideoPopClose"></div></a>',i+="</div>",t("body").append(i);var n=t(".qzVideoPop");setTimeout(function(){n.addClass("cur")},10),n.on("click",e),n.on("click","iframe",function(t){t.stopPropagation()})}t(".qzVideoPopBtn").on("click",function(){var e=t(this),i=e.data("href"),n="",o="http://v.youku.com/v_show/id_",c=i.indexOf(o)+o.length,s=i.indexOf("==.html");n=i.substring(c,s),a(n)})},createAllTopic:function(t){var a="";return a+='<li data-topicid="'+t.Id+'" data-topic="'+t.Title+'"><a href="http://192.168.0.100:9014/apis/m/topic/'+t.Id+'"><b>'+t.Title+'</b><span><i class="num-in">0</i>人参与<i class="num-comm">0</i>条主题</span></a></li>'},allTopic:function(){function a(a){var e="";t.each(a,function(t,a){e+=c.createAllTopic(a)}),n.html(e),t("#qzAllTopicList li").allTopicJoinCount()}function e(a){var e="";t.each(a,function(t,a){e+=c.createAllTopic(a)}),n.append(e),t("#qzAllTopicList li").allTopicJoinCount()}function i(){var e=parseInt(n.attr("data-page"))+1,i={pageIndex:e,pageSize:r};t.ajax({type:"get",dataType:"jsonp",url:s,data:{jsondata:JSON.stringify(i)},success:function(t){n.attr({"data-page":e,"data-infiload":"open"}),a(t)}})}var n=t("#qzAllTopicList"),s="http://192.168.0.100:9014/apis/club/api/gettopicall",r=n.attr("data-pageSize");n.length>0&&(i(),c.infiniteLoad("#qzAllTopicList",function(a,i){var c=t("#qzMain"),d=parseInt(n.attr("data-page"))+1,l={pageIndex:d,pageSize:r};t.ajax({type:"get",dataType:"jsonp",url:s,data:{jsondata:JSON.stringify(l)},beforeSend:function(){c.append(o.loadingDom)},success:function(t){c.find(".qz-loading").remove(),t.length>0?(i.attr("data-page",d),e(t)):"open"===i.attr("data-infiload")&&(i.attr("data-infiload","close"),c.append(o.loadedDom)),o.isCanLoading=!0}})}))},popBaiduShare:function(){function a(){var t="";return t+='<div class="club-pop-baidu-mask clubPopBaidu clubPopBaiduClose"></div>',t+='<div class="club-pop-baidu-main clubPopBaidu">',t+='<div class="club-pop-baidu-head">分享</div>',t+='<div class="club-pop-baidu-body">',t+='<div class="club-pop-baidu-btns bdsharebuttonbox" data-tag="share_1"><a class="bds_tsina" data-cmd="tsina"></a><a class="bds_sqq" data-cmd="sqq"></a><a class="bds_qzone" data-cmd="qzone"></a><a class="bds_more" data-cmd="more"></a><a class="bds_count" data-cmd="count"></a></div>',t+="</div>",t+='<div class="club-pop-baidu-foot"><a class="clubPopBaiduClose">取消</a></div>',t+="</div>"}function e(){var a="http://bdimg.share.baidu.com/static/api/js/share.js?cdnversion="+~(-new Date/36e5);"object"==typeof _bd_share_main?_bd_share_main.init():t.getScript(a)}function i(){var a=t(".clubPopBaidu");a.removeClass("cur"),setTimeout(function(){a.remove(),o.popCommon.close()},250)}function n(){var n=a();t("body").append(n),o.popCommon.open(),setTimeout(function(){t(".clubPopBaidu").addClass("cur")},50),t(".clubPopBaiduClose").on("click",function(){i()}),e()}var o=this;n()},globalBind:function(){var a=t("#qzMain"),e=this;a.on("click",".qzBtnShare",function(){e.popBaiduShare()})},main:function(){c.setRem(),c.addSwpOnce(),c.addComment(),c.addContext(),c.initPageTopic(),c.initPageContext(),c.tabNav(),c.infiniteLoad("#qzCardList",function(t,a){a.getClub()}),c.topicMore(),c.pageGoto(),c.allTopic(),t(window).resize(function(){c.setRem()}),c.globalBind()}};c.main(),t(document).ready(function(){t("#qzCardList").getClub(),t(".qzBtnLike").addLike(),t(".themeNum").joinCount(),t(".qz-nav-sort").change(function(a){a.preventDefault();var e=t(this).find("option:selected").attr("data-sort");t(this).attr("data-sort",e),t("#qzCardList").html("").attr("data-pageIndex",0).attr("data-loading",!1).getClub()})}),t.fn.fabuSubmit=function(a){return this.each(function(){var e=t(this),i=parseInt(e.find(".maxNum").html()),o=e.find(".mathIpt"),s=o.height(),r=parseInt(o.css("line-height")),d=15*r;o.textareaAutoHeight({minHeight:s,maxHeight:d}),e.on("focus",".mathIpt",function(){var a=t(this),e=a.attr("placeholder");a.attr("data-val",e).removeAttr("placeholder").parent().addClass("cur")}).on("blur",".mathIpt",function(){var a=t(this),e=a.attr("data-val");a.attr("placeholder",e).parent().removeClass("cur")}).on("keyup blur",".mathIpt",function(){var t=this.value.length;this.value=this.value.substr(0,i),e.find(".curNum").html(t),e.find(".fabu-num").css("display",t>0?"block":"")}),e.on("click",".qzPopSmt",function(){var e=t(".qz-pic-list-li:not(.temp)"),i=t(".fabuVideo"),o=t(".mathIpt").val(),s=""==o?t(".realIpt").html():o,r=t(".clubId").attr("data-selectClubId");if("true"!=t(this).attr("data-isclick")){t(this).attr("data-isclick",!0);var d="",l=e.length>9?9:e.length-1;if(l>0){d=[];for(var p=0;p<l;p++){var u=e.eq(p).find("img").attr("data-type"),m=e.eq(p).find("img").attr("src"),f=m.replace("tiny","small"),h=m.replace("tiny","origin"),g=m.replace("tiny","tinysquare");"gif"==u&&(h=h.replace(".jpg",".gif"));var v=e.eq(p).find("img").attr("data-height"),b=e.eq(p).find("img").attr("data-width");d.push({tiny:m,tinysquare:g,small:f,origin:h,height:v,width:b,imageType:u})}}var C="";if(i.length>0){var y="",z="",q="",w="",x="";void 0==i.attr("data-tit")?z="视频链接":(y=i.attr("data-vid"),z=i.attr("data-tit"),w=i.attr("data-img"),x=i.attr("data-sitename")),q=i.attr("data-url"),C={image:w,title:z,videoUrl:q,videoVid:y,siteName:x}}if(""==d&&""==C&&!n(s))return void alert("你还没有输入内容!");var k={content:s,
images:d,videos:C,clubId:r,device:1};t.ajax({type:"post",dataType:"json",url:"http://192.168.0.100:9014/apis/club/api/addclubcontent",data:{jsondata:JSON.stringify(k)},success:function(e){if("ok"==e.dataType){t(this).attr("data-isclick",!1),t(".mathIpt").val("");var i=c.createCard(e.cardgroup);t("#qzCardList").prepend(i),c.photoSwp(),t(".qzBtnLike").like(),t(".qzBtnLike").addLike(),t(".qzBtnComment").commentCount(),t("html,body").removeClass("hideScroll").animate({scrollTop:a},0),setTimeout(function(){t(".qzPop").remove()},250)}else alert("发布失败，请重试！")}})}})})},t.fn.selectPhoto=function(){return this.each(function(){t(this).bind("click",function(){t("#fileupload").trigger("click"),t("#fileupload").fileupload({dataType:"json",maxFileSize:"5000000",url:"http://192.168.0.100:9014/apis/uploadpic/index",done:function(a,e){var i=e.result;if("ok"==i.status){var n=t(".qz-pic-list-li .qz-img-remove").length+1;if(n>9)alert("最多只能传9张"),t(".qz-pic-list .temp:first").remove();else{9==n&&t(".qz-pic-list-add").parent().css("display","none");var o="<img src='"+i.tiny+"' data-original='"+i.original+"' data-height=\""+i.height+'" data-width="'+i.width+'" data-type="'+i.imageclass+"\"><a class='qz-img-remove'></a>";t(".qz-pic-list .temp:first").removeClass("temp").html(o)}t(".qz-pic-list .qz-img-remove").each(function(){t(this).unbind("click"),t(this).bind("click",function(){var a=t(this).parents(".pic").find("img").attr("data-original"),e=t(".qz-pic-list-li").not(":last").length;t(this).parent(".qz-pic-list-li").remove(),t.ajax({type:"get",dataType:"json",url:"http://192.168.0.100:9014/apis/uploadpic/delete?origin="+a,data:{},success:function(t){}}),e<9&&t(".qz-pic-list-add").parent().css("display","block")})})}else alert("包含不支持的文件格式"),t(".qz-pic-list .temp:first").remove()},change:function(a,e){var i=0,n=parseInt(t("#fileupload").attr("data-imagesize")),o=n/1024;t.each(e.files,function(a,e){if(e.size/1024>n&&i<=0)i+=1,alert("图片容量超过"+o+"MB，无法上传！");else if(e.size/1024<=n){var c='<div class="qz-pic-list-li temp"><img src="http://image.gamersky.com/webimg15/user/club/pc/loading.gif" ></div>';t(".qz-pic-list-li:first").before(c)}})}})})})},t.fn.getClub=function(a){return this.each(function(){var n=t(this),s=t(".qzNavFx a.cur").attr("data-cfg"),r=i.listNavSetter[s].type,d=i.listNavSetter[s].sort,l=t(".clubId").attr("data-clubId"),p=t(".topic").attr("data-topic"),u=t(".topic").attr("data-topicId"),m=parseInt(n.attr("data-pageIndex"))+1,f=n.attr("data-pageSize"),h=n.attr("data-loading");if("true"!=h){n.attr("data-loading","true");var g=n.find(".qzCard").length,v=0,b=n.find(".qzCard:first").attr("data-cid");void 0!=b&&null!=b||(b=""),g>=50&&(v=g-50),b+=",",n.find(".qzCard:gt("+v+")").each(function(){b+=t(this).attr("data-cid")+","});var C={contentType:r,sort:d,pageIndex:m,pageSize:f,clubId:l,topic:p,topicId:u,excludeIds:b};n.attr("data-pageIndex",m);var y={jsondata:JSON.stringify(C)};e.getWapClubContext(y,function(e){var i=t.parseJSON(e.body);n.attr("data-loading","false"),n.find(".qz-loading").remove();var s=i.cardgroup.length;1==m&&0==s?n.html(o.loadnullDom).attr("data-infiload","close"):1==m&&s>0?(c.insertCard(n,i.cardgroup),s>=f?(n.attr("data-infiload","open"),o.isCanLoading=!0):(o.isCanLoading=!1,n.attr("data-infiload","close").append(o.loadedDom))):m>1&&s>0?(c.appendCard(n,i.cardgroup),n.attr("data-infiload","open"),o.isCanLoading=!0):n.attr("data-infiload","close").append(o.loadedDom),"function"==typeof a&&a&&a()},function(){t(".qz-loadnull,.qz-loaded").remove(),n.append(o.loadingDom)})}})},t.fn.like=function(){var a="";t(this).each(function(){""!=a&&(a+=","),a+=t(this).attr("data-clubcontentid")});var i={clubContentId:a},n={jsondata:JSON.stringify(i)};e.getLike(n,function(a){if("ok"==a.status){var e=t.parseJSON(a.body);t.each(e,function(a,e){t(".qzBtnLike[data-clubcontentid='"+e.Id+"']").each(function(){t(this).find("b").html(e.digg).attr("data-likecount",e.digg)})})}})},t.fn.addLike=function(i){return this.each(function(){var i=t(this);i.unbind("click"),i.click(function(n){n.preventDefault(),t(this).UserOnline(function(t){if("ok"==t.status||"dev"===a){var n=i.attr("data-clubcontentid"),o={clubContentId:n,fromDevice:1},c={jsondata:JSON.stringify(o)};e.addLike(c,function(t){if("err"==t.status)alert(t.body);else{var a=parseInt(i.find("b").html())+1;i.find("b").html(a)}})}})})})},t.fn.commentCount=function(){function a(){var a="";t(i).each(function(){""!=a&&(a+=","),a+=t(this).attr("data-clubcontentid")});var n={clubContentId:a},o={jsondata:JSON.stringify(n)};e.getCommentCount(o,function(a){if("ok"==a.status){var e=t.parseJSON(a.body);t.each(e,function(a,e){t(".qzBtnComment[data-clubcontentid='"+e.Id+"']").each(function(){var a=t(this);t(i).parents(".qzClComment").length>0||(a.html(e.commentCount),a.attr("data-commcount",e.commentCount),t("#qzCardList").length>0&&e.commentCount>0&&a.insertListComment())})})}})}var i=this;a()},t.fn.insertListComment=function(){function a(){var a=n.closest(".qzCard"),i="",o=1,s=n.data("clubcontentid"),r={clubContentId:s,pageIndex:o,pageSize:10},d={jsondata:JSON.stringify(r)};e.getWapClubComment(d,function(e){var o=t.parseJSON(e.body);"ok"===o.dataType&&"ok"!=n.attr("data-isinsert")&&(n.attr("data-isinsert","ok"),i+='<div class="qz-comment-inlist"><ul>',t.each(o.commlist,function(t,a){t<3&&(i+=c.createCardCommentList(a))}),i+="</ul></div>",t(i).insertBefore(a.find("footer")))})}var n=t(this);"open"===i.innerCommentState&&a()},t.fn.joinCount=function(){var a="";t(this).each(function(){""!=a&&(a+=","),a+=t(this).attr("data-topic")});var e={topic:a};t.ajax({type:"get",dataType:"jsonp",url:"http://192.168.0.100:9014/apis/club/api/getjoinarraycount",data:{jsondata:JSON.stringify(e)},success:function(a){"ok"==a.status&&t.each(a.result,function(a,e){t(".themeNum[data-topic='"+e.topic+"']").each(function(){t(this).find(".join").html(e.join+"人"),t(this).find(".theme").html(e.clubContent),t(this).find("span i").html(e.clubContent)})})}})},t.fn.allTopicJoinCount=function(){var a="";t(this).each(function(){""!=a&&(a+=","),a+=t(this).attr("data-topic")});var e={topic:a};t.ajax({type:"get",dataType:"jsonp",url:"http://192.168.0.100:9014/apis/club/api/getjoinarraycount",data:{jsondata:JSON.stringify(e)},success:function(a){"ok"==a.status&&t.each(a.result,function(a,e){t("#qzAllTopicList li[data-topic='"+e.topic+"']").each(function(){t(this).find(".num-in").html(e.join),t(this).find(".num-comm").html(e.clubContent)})})}})},t.fn.addComment=function(a){var e=t(this);if("true"!=e.attr("data-isclick")){e.attr("data-isclick",!0);var i=t.trim(e.parent().siblings(".pop-con").find(".mathIpt").val()),n=e.data("userid"),o=e.data("clubcontentid"),s=e.data("commentid");if(""==i)return void alert("评论不能为空！");if(i.length>=5e3)return void alert("评论不能超过5000个字符！");var r={userId:n,clubContentId:o,content:i,replyId:s,fromDevice:1};t.ajax({type:"post",dataType:"json",url:"http://192.168.0.100:9014/apis/club/api/addcomment",data:{jsondata:JSON.stringify(r)},success:function(i){if("ok"==i.dataType){e.attr("data-isclick",!1);var n=t("#qzClComment");if(n.length>0){var s=c.createCardComment(i.commlist);0==n.find("li").length?n.html(s):n.prepend(s);var r=parseInt(t(".commentNum i,.qzBtnComment").html())+1;t(".commentNum i,#qzCardContext .btn-comment").html(r)}else t(".qzBtnComment[data-clubcontentid="+o+"]").html("1").attr("data-commcount",1);t(".qzPop").removeClass("cur"),t("html,body").removeClass("hideScroll").animate({scrollTop:a},0),setTimeout(function(){t(".qzPop").remove()},250)}else alert(i.body)}})}},t.fn.UserOnline=function(e){t.ajax({type:"GET",dataType:"jsonp",url:"http://192.168.0.100:9014/apis/api/logincheck",success:function(i){"dev"===a?e(i):"ok"!==i.status?(t(".ymw-loginpop-btns").insertYmwLoginPop(),t(".ymw-loginpop-btns").QZloginForm()):e(i)}})},t.fn.QZloginForm=function(){var a=t(this);a.on("click","#qqLogin",function(t){t.preventDefault();var a=window.location.href;window.location.href="http://192.168.0.100:9014/apis/oauth/authorizelogin?authorizetype=qq&returnUrl="+encodeURI(a)}).on("click","#sinaLogin",function(t){t.preventDefault();var a=window.location.href;window.location.href="http://192.168.0.100:9014/apis/oauth/authorizelogin?authorizetype=sina&returnUrl="+encodeURI(a)})},t.fn.insertYmwLoginPop=function(){t(".gsZpPopLoginClose").show(),t(".gs_zp_pop_login").show(),t(".gsZpPopLoginClose").on("click",function(){t(".gs_zp_pop_login").hide(),t(".gsZpPopLoginClose").hide()})},t.fn.removeTarget=function(){return this.each(function(){t(this).find("a").attr("target","_self")})}}(jQuery);
//# sourceMappingURL=qz.wap.min.js.map
