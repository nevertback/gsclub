!function(t){var a=t("#qzMain").attr("clubId"),i=t("#qzMain").attr("topicId"),e=(t("#qzMain").attr("topic"),{listNavSetter:{"new":{sort:1,type:0},hot:{sort:2,type:0},best:{sort:1,type:1}}}),n=function(t){return"undefined"!=typeof t&&t.replace(/(^\s*)|(\s*$)/g,"")};t.fn.extend({textareaAutoHeight:function(a){this._options={minHeight:0,maxHeight:1e3},this.init=function(){for(var i in a)this._options[i]=a[i];0==this._options.minHeight&&(this._options.minHeight=parseFloat(t(this).height()));for(var i in this._options)null==t(this).attr(i)&&t(this).attr(i,this._options[i]);t(this).keyup(this.resetHeight).change(this.resetHeight).focus(this.resetHeight)},this.resetHeight=function(){var a=parseFloat(t(this).attr("minHeight")),i=parseFloat(t(this).attr("maxHeight"));t.browser.msie||t(this).height(0);var e=parseFloat(this.scrollHeight);e=e<a?a:e>i?i:e,t(this).height(e).scrollTop(e),t(this).css("overflow-y",e>=i?"scroll":"hidden")},this.init()}});var o={isCanLoading:!0,loadingDom:'<div class="qz-loading">正在加载</div>',loadedDom:'<div class="qz-loaded">全部加载完成</div>',loadnullDom:'<div class="qz-loadnull">还没有内容</div>'},s={setRem:function(){var a=t(window).width();a>=640&&(a=640),t("html").css({"font-size":a/6.4+"px"})},popCommon:{open:function(){t("html").addClass("hideScroll"),t(".ymw-backtotop").css("display","none")},close:function(){t("html").removeClass("hideScroll"),t(".ymw-backtotop").css("display","block")}},createCard:function(a){var i="";if(i+='<div class="qz-card qzCard" data-cid="'+a.cardid+'">',i+='<header><a class="head"><img src="'+a.head+'" alt="head"></a>',i+='<div class="info"><h5>',i+="<a>"+a.user+"</a>",n(a.vauth)&&(i+='<img src="'+a.vauth+'">'),i+="</h5><p>",i+='<span class="time">'+a.createtime+"</span>",i+="</p>",i+="</div>",a.spectop!==!0&&a.specvalue!==!0||(i+='<div class="spec-icons">',a.spectop===!0&&(i+='<a class="spec-top">置顶</a>'),a.specvalue===!0&&(i+='<a class="spec-value">精</a>'),i+="</div>"),i+="</header>",i+='<section class="detail qzZoneHref" data-href="'+a.url+'">',i+='<div class="content">',a.isVideo?(i+=a.text,i+="<a href="+a.video.src+' class="link-video">'+a.video.videoTitle+"</a>"):i+=a.text,i+="</div>",a.piclist.length>0&&(i+='<div class="media-pic-list"><div class="clearfix qz-figs qzPicPswp">',t.each(a.piclist,function(t,a){i+='<figure class="qzPicPswpBtn',"gif"===a.ext?(i+=' gif"',a.large=a.origin):"long"===a.ext&&(i+=' long"'),i+='"><a data-origin="'+a.origin+'"  data-large="'+a.large+'" data-size="'+a.size+'"><img src="'+a.url+'"></a></figure>'}),i+="</div></div>"),void 0!=a.picbig.large){a.picbig.large=a.picbig.url;var e="";i+='<div class="qzPicPswp media-pic',"gif"===a.picbig.ext?(e=" gif",a.picbig.large=a.picbig.origin):"long"===a.picbig.ext&&(e=" long"),i+='"><figure class="'+e+'"><a data-origin="'+a.picbig.origin+'" data-large="'+a.picbig.large+'" data-size="'+a.picbig.size+'"><img src="'+a.picbig.url+'" class="qzPicPswpBtn"></a></figure></div>'}a.isVideo&&(i+='<div class="media-video">',i+='<a class="qzVideoPopBtn" data-href="'+a.video.src+'"><img src="'+a.video.pic+'" alt=""></a></div>'),i+="</section>",a.fromUrl&&(i+='<div class="from">来自：<a href="'+a.fromUrl+'" >'+a.from+"</a></div>"),i+="<footer>";var o=a.text.replace(/<[^>]+>/g,"").substring(0,200);return i+='<a class="btn-share qzBtnShare" data-sharetext="'+o+'" data-shareurl="'+a.url+'">分享</a>',i+="<span></span>",i+='<a class="btn-comment qzBtnComment" data-commcount=""  data-clubcontentid="'+a.cardid+'"   data-href="'+a.url+'">0</a>',i+="<span></span>",i+='<a class="btn-like qzBtnLike" data-likecount="" data-clubcontentid="'+a.cardid+'" ><i></i><b></b></a>',i+="</footer>",i+="</div>",i+="",i+=""},addSwpOnce:function(){var a='<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button><a target="_blank" class="pswp__button pswpBtnOrigin pswp__single-tap" title="查看原图"></a> <button class="pswp__button pswp__button--share" title="Share"></button> <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button> <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button> <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div>';t("body").append(a)},photoSwp:function(){var a=function(a){for(var i=function(t){for(var a,i,e,n,o=t.childNodes,s=o.length,c=[],r=0;r<s;r++)a=o[r],1===a.nodeType&&(i=a.children[0],e=i.getAttribute("data-size").split("x"),n={src:i.getAttribute("data-large"),w:parseInt(e[0],10),h:parseInt(e[1],10),ori:i.getAttribute("data-origin")},a.children.length>1&&(n.title=a.children[1].innerHTML),i.children.length>0&&(n.msrc=i.children[0].getAttribute("src")),n.el=a,c.push(n));return c},e=function l(t,a){return t&&(a(t)?t:l(t.parentNode,a))},n=function(t){t=t||window.event,t.preventDefault?t.preventDefault():t.returnValue=!1;var a=t.target||t.srcElement,i=e(a,function(t){return t.tagName&&"FIGURE"===t.tagName.toUpperCase()});if(i){for(var n,s=i.parentNode,c=i.parentNode.childNodes,r=c.length,l=0,d=0;d<r;d++)if(1===c[d].nodeType){if(c[d]===i){n=l;break}l++}return n>=0&&o(n,s),!1}},o=function(a,e,n,o){function s(a){t(".pswpBtnOrigin").attr("href",l[a].ori)}var c,r,l,d=t(".pswp")[0];if(l=i(e),r={shareEl:!1,fullscreenEl:!1,zoomEl:!1,bgOpacity:1,showHideOpacity:0,galleryUID:e.getAttribute("data-pswp-uid"),history:!1,tapToClose:!0,getThumbBoundsFn:function(t){var a=l[t].el.getElementsByTagName("img")[0],i=window.pageYOffset||document.documentElement.scrollTop,e=a.getBoundingClientRect();return{x:e.left,y:e.top+i,w:e.width}}},o)if(r.galleryPIDs){for(var p=0;p<l.length;p++)if(l[p].pid==a){r.index=p;break}}else r.index=parseInt(a,10)-1;else r.index=parseInt(a,10);isNaN(r.index)||(n&&(r.showAnimationDuration=0),c=new PhotoSwipe(d,PhotoSwipeUI_Default,l,r),c.init(),c.listen("initialZoomIn",function(){s(c.getCurrentIndex()),t(".pswp").animate({opacity:1},333)}),c.listen("initialZoomOut",function(){t(".pswp").animate({opacity:0},200)}),c.listen("afterChange",function(){s(c.getCurrentIndex())}))},s=document.querySelectorAll(a),c=0,r=s.length;c<r;c++)s[c].setAttribute("data-pswp-uid",c+1),s[c].onclick=n};a(".qzPicPswp")},insertCard:function(a,i){var e="";t.each(i,function(t,a){e+=s.createCard(a)}),t(a).html(e),t(".qzBtnLike").like(),t(".qzBtnLike").addLike(),t(".qzBtnComment").commentCount(),t(".qzCard .content").removeTarget(),s.photoSwp(),s.openVideoPop()},appendCard:function(a,i){var e="";t.each(i,function(t,a){e+=s.createCard(a)}),t(a).append(e),t(".qzBtnLike").like(),t(".qzBtnLike").addLike(),t(".qzBtnComment").commentCount(),t(".qzCard .content").removeTarget(),s.photoSwp(),s.openVideoPop()},addContext:function(){function a(a){function i(){l.find(".realIpt").on("input",function(){l.find(".mathIpt").val(l.find(".realIpt").val());var t=l.find(".mathIpt")[0].scrollHeight;l.find(".realIpt").css("height",t)})}function e(){l.removeClass("cur"),t("html,body").removeClass("hideScroll").animate({scrollTop:a},0),setTimeout(function(){l.remove()},250)}var o=t("#qzCardList"),s=o.data("topic"),c=o.data("clubname"),r="";r+='<div class="qz-pop qzPop">',r+='<header>发布内容<a class="qz-pop-close qzPopClose"></a><a class="qz-pop-smt qzPopSmt">发布</a></header>',r+='<div class="pop-con">',r+='<div class="pop-srl"><textarea class="realIpt" placeholder="分享你的游戏心得...">',n(s)&&(r+=s),r+='</textarea > <textarea class="mathIpt" rows="3"></textarea></div > ',r+='<div class="clearfix qz-pic-list">',r+='<div class="qz-pic-list-li"><label for="qzSelectPhoto" class="qz-pic-list-add"></label></div>',r+="</div>",r+='<input id="fileupload"  data-imagesize="5120"   type="file" style="display:none" name="files" method="POST" multiple="">',r+="</div>",r+='<footer><label for="qzSelectPhoto" class="qz-upload-pic qzUploadPic">图片</label><select class="qz-pop-sel">',r+="</select>",r+="</footer></div>",t("body").append(r);var l=t(".qzPop");t(".qz-pic-list-add,.qzUploadPic").selectPhoto(),n(c)&&t(".qz-pop-sel").html("<option value='clubId'>发往"+c+"</option>"),setTimeout(function(){l.addClass("cur")},10),i(),t(".qzPopClose").on("click",e),l.fabuSubmit(a)}t("#qzMain").on("click",".qzBtnContext",function(){t(this).UserOnline(function(i){if("ok"==i.status){var e=t("html").scrollTop();0===e&&(e=t("body").scrollTop()),setTimeout(function(){t("html,body").addClass("hideScroll")},300),a(e)}})})},addComment:function(){function a(a,i,e,n,o){function s(){d.find(".realIpt").on("input",function(){d.find(".mathIpt").val(d.find(".realIpt").val());var t=d.find(".mathIpt")[0].scrollHeight;d.find(".realIpt").css("height",t)})}function c(){d.removeClass("cur"),t("html,body").removeClass("hideScroll").animate({scrollTop:a},0),setTimeout(function(){d.remove()},250)}var r="",l=n?"回复 "+n+"：":"我来说两句...";r+='<div class="qz-pop qzPop">',r+='<header>评论<a class="qz-pop-close qzPopClose"></a><a data-userId="'+o+'" data-clubContentId="'+i+'"  data-commentId="'+e+'" class="qz-pop-smt qzPopSmt">发布</a></header>',r+='<div class="pop-con"><div class="pop-srl"><textarea class="realIpt" placeholder="'+l+'"></textarea><textarea class="mathIpt" rows="3"></textarea></div></div>',r+="</div>",t("body").append(r);var d=t(".qzPop");setTimeout(function(){d.addClass("cur")},10),s(),t(".qzPopClose").on("click",c),t(".qzPopSmt").on("click",function(){d.find(".realIpt").val();t(this).addComment(a)})}t("#qzMain").on("click",".qzBtnComment",function(){var i=t(this);i.UserOnline(function(e){if("ok"==e.status){var n=t("html").scrollTop(),o=i.data("clubcontentid"),s=i.data("commcount"),c=i.data("href"),r=i.data("userid"),l=i.data("commid"),d=i.attr("data-name");if(t("#qzCardContext").length>0)return 0===n&&(n=t("body").scrollTop()),setTimeout(function(){t("html,body").addClass("hideScroll")},300),a(n,o,l,d,r),!1;0===s||""==s?(0===n&&(n=t("body").scrollTop()),setTimeout(function(){t("html,body").addClass("hideScroll")},300),a(n,o,l,d,r)):window.location.href=c}})})},addLike:function(){t("#qzMain").on("click",".qzBtnLike",function(){var a=t(this),i=(a.closest(".qzCard").data("cid"),a.attr("data-likecount"));1===parseInt(a.attr("data-islike"))?a.removeClass("cur").attr("data-islike","0").attr("data-likecount",parseInt(i)-1).find("b").html(parseInt(i)-1):a.addClass("cur").attr("data-islike","1").attr("data-likecount",parseInt(i)+1).find("b").html(parseInt(i)+1)})},infiniteLoad:function(a,i){function e(){var e=t(a);"open"===e.attr("data-infiload")&&"function"==typeof i&&i(a,e)}function n(){var a=t("html").scrollTop(),i=t(document).height(),n=t(window).height();0===a&&(a=t("body").scrollTop()),a>i-n-20&&a>n-i&&o.isCanLoading===!0&&(o.isCanLoading=!1,e())}t(a).length>0&&t(window).scroll(function(){n()})},tabNav:function(){function a(){function a(){var a=r.offset().top,i=t("html").scrollTop();0===i&&(i=t("body").scrollTop()),i>=a?c.addClass("openQzNavFixed"):c.removeClass("openQzNavFixed")}function i(){var a=t("html"),i=a.height(),e=r.offset().top,n=a.scrollTop();0===n&&(n=t("body").scrollTop()),a.css("height",i),n>e&&t("html,body").animate({scrollTop:e},0)}function e(){var a=t("html");clearTimeout(n),n=setTimeout(function(){a.css("height","")},200)}var n,s=t(".qzNavFx"),c=t(".qzNavFxW"),r=t(".qzNavPos");a(),t(window).scroll(function(){a()}),s.find("a").on("click",function(){var a=t(this),n="#qzCardList";s.find("a").removeClass("cur"),a.addClass("cur"),t(n).html("").attr("data-pageIndex",0).attr("data-loading",!1),o.isCanLoading=!1,i(),t(n).getClub(function(){e()})})}t(".qzNavFx").length>0&&a()},pageGoto:function(){var a=t(".qz-card-list");a.on("click",".qzCard .qzZoneHref",function(){var a=t(this),i=a.data("href");window.open(i,"_blank")}),a.on("click",".qzZoneHref figure,.qzZoneHref a",function(t){t.stopPropagation()})},openVideoPop:function(){function a(a){function i(){n.removeClass("cur"),setTimeout(function(){n.remove()},250)}var e="";e+='<div class="qz-video-pop qzVideoPop">',e+='<div class="qz-video-pop-con">',e+='<iframe height="100%" width="100%" src="http://player.youku.com/embed/'+a+'" frameborder=0 allowfullscreen></iframe>',e+="</div>",e+='<div class="qz-video-bar"><a class="qz-video-pop-close qzVideoPopClose"></div></a>',e+="</div>",t("body").append(e);var n=t(".qzVideoPop");setTimeout(function(){n.addClass("cur")},10),n.on("click",i),n.on("click","iframe",function(t){t.stopPropagation()})}t(".qzVideoPopBtn").on("click",function(){var i=t(this),e=i.data("href"),n="",o="http://v.youku.com/v_show/id_",s=e.indexOf(o)+o.length,c=e.indexOf("==.html");n=e.substring(s,c),a(n)})},popBaiduShare:function(a,i){function e(){var t="";return t+='<div class="club-pop-baidu-mask clubPopBaidu clubPopBaiduClose"></div>',t+='<div class="club-pop-baidu-main clubPopBaidu">',t+='<div class="club-pop-baidu-head">分享</div>',t+='<div class="club-pop-baidu-body">',t+='<div class="club-pop-baidu-btns bdsharebuttonbox" data-tag="share_1"><a class="bds_tsina" data-cmd="tsina"></a><a class="bds_sqq" data-cmd="sqq"></a><a class="bds_qzone" data-cmd="qzone"></a><a class="bds_more" data-cmd="more"></a><a class="bds_count" data-cmd="count"></a></div>',t+="</div>",t+='<div class="club-pop-baidu-foot"><a class="clubPopBaiduClose">取消</a></div>',t+="</div>"}function n(){var e="http://bdimg.share.baidu.com/static/api/js/share.js?cdnversion="+~(-new Date/36e5);window._bd_share_config={common:{bdText:i,bdDesc:i,bdUrl:a},share:[{tag:"share_1",bdSize:32}]},"object"==typeof _bd_share_main?_bd_share_main.init():t.getScript(e)}function o(){var a=t(".clubPopBaidu");a.removeClass("cur"),setTimeout(function(){a.remove(),c.popCommon.close()},250)}function s(){var a=e();t("body").append(a),c.popCommon.open(),setTimeout(function(){t(".clubPopBaidu").addClass("cur"),n()},50),t(".clubPopBaiduClose").on("click",function(){o()})}var c=this;s()},globalBind:function(){var a=t("#qzMain"),i=this;a.on("click",".qzBtnShare",function(){var a=t(this),e=a.data("sharetext"),n=a.data("shareurl");i.popBaiduShare(n,e)})},main:function(){s.setRem(),s.addSwpOnce(),s.addComment(),s.addContext(),s.tabNav(),s.infiniteLoad("#qzCardList",function(t,a){a.getClub()}),s.pageGoto(),s.globalBind(),t(window).resize(function(){s.setRem()})}};t.fn.UserOnline=function(a){t.ajax({type:"GET",dataType:"jsonp",url:"http://i.gamersky.com/api/logincheck",success:function(i){"ok"!==i.status?(t(".ymw-loginpop-btns").insertYmwLoginPop(),t(".ymw-loginpop-btns").QZloginForm()):a(i)}})},t.fn.QZloginForm=function(){var a=t(this);a.on("click","#qqLogin",function(t){t.preventDefault();var a=window.location.href;window.location.href="http://i.gamersky.com/oauth/authorizelogin?authorizetype=qq&returnUrl="+encodeURI(a)}).on("click","#sinaLogin",function(t){t.preventDefault();var a=window.location.href;window.location.href="http://i.gamersky.com/oauth/authorizelogin?authorizetype=sina&returnUrl="+encodeURI(a)})},t.fn.insertYmwLoginPop=function(){t(".gsZpPopLoginClose,.gs_zp_pop_login").show(),t(".gsZpPopLoginClose").on("click",function(){t(".gs_zp_pop_login,.gsZpPopLoginClose").hide()})},t.fn.selectPhoto=function(){return this.each(function(){t(this).bind("click",function(){t("#fileupload").trigger("click"),t("#fileupload").fileupload({type:"post",dataType:"json",crossDomain:!0,maxFileSize:"5000000",url:"http://i.gamersky.com/uploadpic/index",done:function(a,i){var e=i.result;if("ok"==e.status){var n=t(".qz-pic-list-li .qz-img-remove").length+1;if(n>9)alert("最多只能传9张"),t(".qz-pic-list .temp:first").remove();else{9==n&&t(".qz-pic-list-add").parent().css("display","none");var o="<img src='"+e.tiny+"' data-original='"+e.original+"' data-height=\""+e.height+'" data-width="'+e.width+'" data-type="'+e.imageclass+"\"><a class='qz-img-remove'></a>";t(".qz-pic-list .temp:first").removeClass("temp").html(o)}t(".qz-pic-list .qz-img-remove").each(function(){t(this).unbind("click"),t(this).bind("click",function(){var a=t(this).parents(".pic").find("img").attr("data-original"),i=t(".qz-pic-list-li").not(":last").length;t(this).parent(".qz-pic-list-li").remove(),t.ajax({type:"get",dataType:"json",url:"http://i.gamersky.com/uploadpic/delete?origin="+a,data:{},success:function(t){}}),i<9&&t(".qz-pic-list-add").parent().css("display","block")})})}else alert("包含不支持的文件格式"),t(".qz-pic-list .temp:first").remove()},change:function(a,i){var e=0,n=parseInt(t("#fileupload").attr("data-imagesize")),o=n/1024;t.each(i.files,function(a,i){if(i.size/1024>n&&e<=0)e+=1,alert("图片容量超过"+o+"MB，无法上传！");else if(i.size/1024<=n){var s='<div class="qz-pic-list-li temp"><img src="http://image.gamersky.com/webimg15/user/club/pc/loading.gif" ></div>';t(".qz-pic-list-li:first").before(s)}})}})})})},t.fn.fabuSubmit=function(i){return this.each(function(){var e=t(this),o=parseInt(e.find(".maxNum").html()),c=e.find(".mathIpt"),r=c.height(),l=parseInt(c.css("line-height")),d=15*l;c.textareaAutoHeight({minHeight:r,maxHeight:d}),e.on("focus",".mathIpt",function(){var a=t(this),i=a.attr("placeholder");a.attr("data-val",i).removeAttr("placeholder").parent().addClass("cur")}).on("blur",".mathIpt",function(){var a=t(this),i=a.attr("data-val");a.attr("placeholder",i).parent().removeClass("cur")}).on("keyup blur",".mathIpt",function(){var t=this.value.length;this.value=this.value.substr(0,o),e.find(".curNum").html(t),e.find(".fabu-num").css("display",t>0?"block":"")}),e.on("click",".qzPopSmt",function(){if("true"!=t(this).attr("data-isclick")){t(this).attr("data-isclick",!0);var e=t(".qz-pic-list-li:not(.temp)"),o=t(".fabuVideo"),c=t(".mathIpt").val(),r="",l=e.length>9?9:e.length-1;if(l>0){r=[];for(var d=0;d<l;d++){var p=e.eq(d).find("img").attr("data-type"),u=e.eq(d).find("img").attr("src"),m=u.replace("tiny","small"),h=u.replace("tiny","origin"),f=u.replace("tiny","tinysquare");"gif"==p&&(h=h.replace(".jpg",".gif"));var v=e.eq(d).find("img").attr("data-height"),g=e.eq(d).find("img").attr("data-width");r.push({tiny:u,tinysquare:f,small:m,origin:h,height:v,width:g,imageType:p})}}var b="";if(o.length>0){var z="",q="",y="",w="",C="";void 0==o.attr("data-tit")?q="视频链接":(z=o.attr("data-vid"),q=o.attr("data-tit"),w=o.attr("data-img"),C=o.attr("data-sitename")),y=o.attr("data-url"),b={image:w,title:q,videoUrl:y,videoVid:z,siteName:C}}if(""==r&&""==b&&!n(c))return void alert("你还没有输入内容!");var _={content:c,images:r,videos:b,clubId:a,device:1};t.ajax({type:"post",dataType:"json",crossDomain:!0,xhrFields:{withCredentials:!0},url:"http://i.gamersky.com/club/api/addclubcontent",data:{jsondata:JSON.stringify(_)},success:function(a){if("ok"==a.dataType){t(this).attr("data-isclick",!1),t(".mathIpt").val("");var e=s.createCard(a.cardgroup);t("#qzCardList").prepend(e),s.photoSwp(),t(".qzBtnLike").like(),t(".qzBtnLike").addLike(),t(".qzBtnComment").commentCount(),t("html,body").removeClass("hideScroll").animate({scrollTop:i},0),setTimeout(function(){t(".qzPop").remove()},250)}else alert("发布失败，请重试！")}})}})})},t.fn.like=function(){var a="";t(this).each(function(){""!=a&&(a+=","),a+=t(this).attr("data-clubcontentid")});var i={clubContentId:a};t.ajax({type:"get",dataType:"jsonp",url:"http://i.gamersky.com/club/api/getlike",data:{jsondata:JSON.stringify(i)},success:function(a){if("ok"==a.status){var i=t.parseJSON(a.body);t.each(i,function(a,i){t(".qzBtnLike[data-clubcontentid='"+i.Id+"']").each(function(){t(this).find("b").html(i.digg),t(this).attr("data-likecount",i.digg)})})}}})},t.fn.addLike=function(a){return this.each(function(){var a=t(this);a.unbind("click"),a.click(function(i){i.preventDefault(),t(this).UserOnline(function(i){if("ok"==i.status){var e=a.attr("data-clubcontentid"),n={clubContentId:e,fromDevice:1};t.ajax({type:"get",dataType:"jsonp",url:"http://i.gamersky.com/club/api/addlike",data:{jsondata:JSON.stringify(n)},success:function(i){if("err"==i.status)alert(i.body);else{var e=parseInt(a.find("b").html())+1;a.find("b").html(e),t(".tabNavCl a").eq(1).find("i").html(e)}}})}})})})},t.fn.commentCount=function(){var a="";t(this).each(function(){""!=a&&(a+=","),a+=t(this).attr("data-clubcontentid")});var i={clubContentId:a};t.ajax({type:"get",dataType:"jsonp",url:"http://i.gamersky.com/club/api/getcommentcount",data:{jsondata:JSON.stringify(i)},success:function(a){if("ok"==a.status){var i=t.parseJSON(a.body);t.each(i,function(a,i){t(".qzBtnComment[data-clubcontentid='"+i.Id+"']").each(function(){t(this).html(i.commentCount),t(this).attr("data-commcount",i.commentCount)})})}}})},t.fn.addComment=function(a){var i=t(this);if("true"!=i.attr("data-isclick")){i.attr("data-isclick",!0);var e=t.trim(i.parent().siblings(".pop-con").find(".mathIpt").val()),n=i.data("userid"),o=i.data("clubcontentid"),s=i.data("commentid");if(""==e)return void alert("评论不能为空！");if(e.length>=5e3)return void alert("评论不能超过5000个字符！");var c={userId:n,clubContentId:o,content:e,replyId:s,fromDevice:1};t.ajax({type:"post",dataType:"json",crossDomain:!0,xhrFields:{withCredentials:!0},url:"http://i.gamersky.com/club/api/addcomment",data:{jsondata:JSON.stringify(c)},success:function(e){"ok"==e.dataType?(i.attr("data-isclick",!1),t(".qzBtnComment[data-clubcontentid="+o+"]").html("1").attr("data-commcount",1),t(".qzPop ").removeClass("cur"),t("html,body").removeClass("hideScroll").animate({scrollTop:a},0),setTimeout(function(){t(".qzPop ").remove()},250)):alert(e.body)}})}},t.fn.getClub=function(n){return this.each(function(){var c=t(this),r=t(".qzNavFx a.cur").attr("data-cfg"),l=e.listNavSetter[r].type,d=e.listNavSetter[r].sort,p=parseInt(c.attr("data-pageIndex"))+1,u=c.attr("data-pageSize"),m=c.attr("data-loading");if("true"!=m){c.attr("data-loading","true");var h=c.find(".qzCard").length,f=0,v=c.find(".qzCard:first").attr("data-cid");void 0!=v&&null!=v||(v=""),v+=",",h>=50&&(f=h-50),c.find(".qzCard:gt("+f+")").each(function(){v+=t(this).attr("data-cid")+","});var g={contentType:l,sort:d,pageIndex:p,pageSize:u,clubId:a,topicId:i,excludeIds:v};c.attr("data-pageIndex",p),t.ajax({type:"get",dataType:"jsonp",url:"http://i.gamersky.com/club/api/getwebcallclubcontent",data:{jsondata:JSON.stringify(g)},beforeSend:function(){t(".qz-loadnull,.qz-loaded").remove(),c.append(o.loadingDom)},success:function(a){if(1==p&&c.attr("data-clubname",a.clubName).attr("data-topic",a.topic),"ok"==a.dataType){c.attr("data-loading","false"),c.find(".qz-loading").remove();var i=a.cardgroup.length;1==p&&0==i?c.html(o.loadnullDom).attr("data-infiload","close"):1==p&&i>0?(s.insertCard(c,a.cardgroup),c.attr("data-infiload","open"),o.isCanLoading=!0):p>1&&i>0?(s.appendCard(c,a.cardgroup),c.attr("data-infiload","open"),o.isCanLoading=!0):c.attr("data-infiload","close").append(o.loadedDom),t(".qzBtnLike").like(),t(".qzBtnLike").addLike(),t(".qzBtnComment").commentCount()}else c.find(".qz-loading").remove(),o.isCanLoading=!1,p>1?c.attr("data-loading","true").append(o.loadedDom):c.attr("data-loading","true").html(o.loadnullDom);"function"==typeof n&&n&&n()}})}})},t.fn.removeTarget=function(){return this.each(function(){t(this).find("a").attr("target","_self")})},t.fn.joinCount=function(){var e={clubId:a,topicId:i};t.ajax({type:"get",dataType:"jsonp",url:"http://i.gamersky.com/club/api/getjoincount",data:{jsondata:JSON.stringify(e)},success:function(a){t(".joinCount").find("p span").eq(0).html(a.join+"人"),t(".joinCount").find("p span").eq(1).html(a.clubContent)}})},t.fn.showNav=function(){var e=this;return this.each(function(){var n={clubId:a,topicId:i};t.ajax({type:"get",dataType:"jsonp",url:"http://i.gamersky.com/club/api/isshownav",data:{jsondata:JSON.stringify(n)},success:function(n){n.isElite&&t(e).find('a[data-cfg="best"]').css("display","block");var o;a>0&&(o=n.clubWapIcon),""!==t.trim(i)&&(o=n.topicWapIcon),t("#qzMain .icon img").attr("src",o)}})})},s.main(),t(document).ready(function(){t("#qzCardList").getClub(),t(".qzNavFx").showNav(),t(".joinCount").joinCount();var e="";a>0&&(t(".qwqz").html("前往圈子"),e="http://i.gamersky.com/m/club/"+a),i>0&&(t(".qwqz").html("前往话题"),e=a>0?"http://i.gamersky.com/m/topic/"+i+"?club="+a:"http://i.gamersky.com/m/topic/"+i),t(".qwqz").attr("href",e)})}(jQuery);
//# sourceMappingURL=qz.wapwebcall.v1.0.1.min.js.map
