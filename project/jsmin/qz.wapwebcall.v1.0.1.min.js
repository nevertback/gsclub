!function(t){var a=t("#qzMain").attr("clubId"),i=t("#qzMain").attr("topicId"),e=(t("#qzMain").attr("topic"),{listNavSetter:{"new":{sort:1,type:0},hot:{sort:2,type:0},best:{sort:1,type:1}}}),o=function(t){return"undefined"!=typeof t&&t.replace(/(^\s*)|(\s*$)/g,"")};t.fn.extend({textareaAutoHeight:function(a){this._options={minHeight:0,maxHeight:1e3},this.init=function(){for(var i in a)this._options[i]=a[i];0==this._options.minHeight&&(this._options.minHeight=parseFloat(t(this).height()));for(var i in this._options)null==t(this).attr(i)&&t(this).attr(i,this._options[i]);t(this).keyup(this.resetHeight).change(this.resetHeight).focus(this.resetHeight)},this.resetHeight=function(){var a=parseFloat(t(this).attr("minHeight")),i=parseFloat(t(this).attr("maxHeight"));t.browser.msie||t(this).height(0);var e=parseFloat(this.scrollHeight);e=e<a?a:e>i?i:e,t(this).height(e).scrollTop(e),t(this).css("overflow-y",e>=i?"scroll":"hidden")},this.init()}});var n={isCanLoading:!0,loadingDom:'<div class="qz-loading">正在加载</div>',loadedDom:'<div class="qz-loaded">全部加载完成</div>',loadnullDom:'<div class="qz-loadnull">还没有内容</div>'},s={setRem:function(){function a(){var t,a=n.height();t=720*(a+.15/6.4*i)/640,e.css("height",t)}var i=t(window).width(),e=t("#QZCMT"),o=e.attr("data-scale"),n=t("#qzMain");if(i>=640&&(i=640),720===parseInt(o)){var s="";s+="<style>",s+=".qz-video-pop .qz-video-pop-con iframe{width:7.2rem;height:4.05rem}\n.ymw-backtotop a{width:.7rem;height:.7rem}\n.qzFixSmt{bottom:1.1rem;width:.7rem;height:.7rem;background-size:.3375rem .315rem;background-position:.22rem .2025rem}\n",s+="</style>",t("head").append(s),n.css({margin:0}),n.find(".qz-card-top,.qz-box").css({"transform-origin":"0 0",transform:"scale(1.125)",margin:0}),setInterval(a,200)}else t("html").css({"font-size":i/6.4+"px"})},popCommon:{open:function(){t("html").addClass("hideScroll"),t(".ymw-backtotop").css("display","none")},close:function(){t("html").removeClass("hideScroll"),t(".ymw-backtotop").css("display","block")}},createCard:function(a){var i="";if(i+='<div class="qz-card qzCard" data-cid="'+a.cardid+'">',i+='<header><a class="head"><img src="'+a.head+'" alt="head"></a>',i+='<div class="info"><h5>',i+="<a>"+a.user+"</a>",o(a.vauth)&&(i+='<img src="'+a.vauth+'">'),i+="</h5><p>",i+='<span class="time">'+a.createtime+"</span>",i+="</p>",i+="</div>",a.spectop!==!0&&a.specvalue!==!0||(i+='<div class="spec-icons">',a.spectop===!0&&(i+='<a class="spec-top">置顶</a>'),a.specvalue===!0&&(i+='<a class="spec-value">精</a>'),i+="</div>"),i+="</header>",i+='<section class="detail qzZoneHref" data-href="'+a.url+'">',i+='<div class="content">',a.isVideo?(i+=a.text,i+="<a href="+a.video.src+' class="link-video">'+a.video.videoTitle+"</a>"):i+=a.text,i+="</div>",a.piclist.length>0&&(i+='<div class="media-pic-list"><div class="clearfix qz-figs qzPicPswp">',t.each(a.piclist,function(t,a){i+='<figure class="qzPicPswpBtn',"gif"===a.ext?(i+=' gif"',a.large=a.origin):"long"===a.ext&&(i+=' long"'),i+='"><a data-origin="'+a.origin+'"  data-large="'+a.large+'" data-size="'+a.size+'"><img src="'+a.url+'"></a></figure>'}),i+="</div></div>"),void 0!=a.picbig.large){a.picbig.large=a.picbig.url;var e="";i+='<div class="qzPicPswp media-pic',"gif"===a.picbig.ext?(e=" gif",a.picbig.large=a.picbig.origin):"long"===a.picbig.ext&&(e=" long"),i+='"><figure class="'+e+'"><a data-origin="'+a.picbig.origin+'" data-large="'+a.picbig.large+'" data-size="'+a.picbig.size+'"><img src="'+a.picbig.url+'" class="qzPicPswpBtn"></a></figure></div>'}a.isVideo&&(i+='<div class="media-video">',i+='<a class="qzVideoPopBtn" data-href="'+a.video.src+'"><img src="'+a.video.pic+'" alt=""></a></div>'),i+="</section>",a.fromUrl&&(i+='<div class="from">来自：<a href="'+a.fromUrl+'" >'+a.from+"</a></div>"),i+="<footer>";var n=a.text.replace(/<[^>]+>/g,"").substring(0,200);return i+='<a class="btn-share qzBtnShare" data-sharetext="'+n+'" data-shareurl="'+a.url+'">分享</a>',i+="<span></span>",i+='<a class="btn-comment qzBtnComment" data-commcount=""  data-clubcontentid="'+a.cardid+'"   data-href="'+a.url+'">0</a>',i+="<span></span>",i+='<a class="btn-like qzBtnLike" data-likecount="" data-clubcontentid="'+a.cardid+'" ><i></i><b></b></a>',i+="</footer>",i+="</div>",i+="",i+=""},addSwpOnce:function(){var a='<div class="pswp pswpClub" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button><a target="_blank" class="pswp__button pswpBtnOrigin pswp__single-tap" title="查看原图"></a> <button class="pswp__button pswp__button--share" title="Share"></button> <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button> <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button> <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div>';t("body").append(a)},photoSwp:function(){var a=function(a){for(var i=function(t){for(var a,i,e,o,n=t.childNodes,s=n.length,r=[],d=0;d<s;d++)a=n[d],1===a.nodeType&&(i=a.children[0],e=i.getAttribute("data-size").split("x"),o={src:i.getAttribute("data-large"),w:parseInt(e[0],10),h:parseInt(e[1],10),ori:i.getAttribute("data-origin")},a.children.length>1&&(o.title=a.children[1].innerHTML),i.children.length>0&&(o.msrc=i.children[0].getAttribute("src")),o.el=a,r.push(o));return r},e=function l(t,a){return t&&(a(t)?t:l(t.parentNode,a))},o=function(t){t=t||window.event,t.preventDefault?t.preventDefault():t.returnValue=!1;var a=t.target||t.srcElement,i=e(a,function(t){return t.tagName&&"FIGURE"===t.tagName.toUpperCase()});if(i){for(var o,s=i.parentNode,r=i.parentNode.childNodes,d=r.length,l=0,c=0;c<d;c++)if(1===r[c].nodeType){if(r[c]===i){o=l;break}l++}return o>=0&&n(o,s),!1}},n=function(a,e,o,n){function s(a){t(".pswpClub .pswpBtnOrigin").attr("href",l[a].ori)}var r,d,l,c=t(".pswpClub")[0];if(l=i(e),d={shareEl:!1,fullscreenEl:!1,zoomEl:!1,bgOpacity:1,showHideOpacity:0,galleryUID:e.getAttribute("data-pswp-uid"),history:!1,tapToClose:!0,getThumbBoundsFn:function(t){var a=l[t].el.getElementsByTagName("img")[0],i=window.pageYOffset||document.documentElement.scrollTop,e=a.getBoundingClientRect();return{x:e.left,y:e.top+i,w:e.width}}},n)if(d.galleryPIDs){for(var p=0;p<l.length;p++)if(l[p].pid==a){d.index=p;break}}else d.index=parseInt(a,10)-1;else d.index=parseInt(a,10);isNaN(d.index)||(o&&(d.showAnimationDuration=0),r=new PhotoSwipe(c,PhotoSwipeUI_Default,l,d),r.init(),r.listen("initialZoomIn",function(){s(r.getCurrentIndex()),t(".pswpClub").animate({opacity:1},333)}),r.listen("initialZoomOut",function(){t(".pswpClub").animate({opacity:0},200)}),r.listen("afterChange",function(){s(r.getCurrentIndex())}))},s=document.querySelectorAll(a),r=0,d=s.length;r<d;r++)s[r].setAttribute("data-pswp-uid",r+1),s[r].onclick=o};a(".qzPicPswp")},insertCard:function(a,i){var e="";t.each(i,function(t,a){e+=s.createCard(a)}),t(a).html(e),t(".qzBtnLike").like(),t(".qzBtnLike").addLike(),t(".qzBtnComment").commentCount(),t(".qzCard .content").removeTarget(),s.photoSwp(),s.openVideoPop()},appendCard:function(a,i){var e="";t.each(i,function(t,a){e+=s.createCard(a)}),t(a).append(e),t(".qzBtnLike").like(),t(".qzBtnLike").addLike(),t(".qzBtnComment").commentCount(),t(".qzCard .content").removeTarget(),s.photoSwp(),s.openVideoPop()},addContext:function(){function a(a){function i(){l.find(".realIpt").on("input",function(){l.find(".mathIpt").val(l.find(".realIpt").val());var t=l.find(".mathIpt")[0].scrollHeight;l.find(".realIpt").css("height",t)})}function e(){l.removeClass("cur"),t("html,body").removeClass("hideScroll").animate({scrollTop:a},0),setTimeout(function(){l.remove()},250)}var n=t("#qzCardList"),s=n.data("topic"),r=n.data("clubname"),d="";d+='<div class="qz-pop qzPop">',d+='<header>发布内容<a class="qz-pop-close qzPopClose"></a><a class="qz-pop-smt qzPopSmt">发布</a></header>',d+='<div class="pop-con">',d+='<div class="pop-srl"><textarea class="realIpt" placeholder="分享你的游戏心得...">',o(s)&&(d+=s),d+='</textarea > <textarea class="mathIpt" rows="3"></textarea></div > ',d+='<div class="clearfix qz-pic-list">',d+='<div class="qz-pic-list-li"><label for="qzSelectPhoto" class="qz-pic-list-add"></label></div>',d+="</div>",d+='<input id="fileupload"  data-imagesize="5120"   type="file" style="display:none" name="files" method="POST" multiple="">',d+="</div>",d+='<footer><label for="qzSelectPhoto" class="qz-upload-pic qzUploadPic">图片</label><select class="qz-pop-sel">',d+="</select>",d+="</footer></div>",t("body").append(d);var l=t(".qzPop");t(".qz-pic-list-add,.qzUploadPic").selectPhoto(),o(r)&&t(".qz-pop-sel").html("<option value='clubId'>发往"+r+"</option>"),setTimeout(function(){l.addClass("cur")},10),i(),t(".qzPopClose").on("click",e),l.fabuSubmit(a)}t("#qzMain").on("click",".qzBtnContext",function(){t(this).UserOnline(function(i){if("ok"==i.status){var e=t("html").scrollTop();0===e&&(e=t("body").scrollTop()),setTimeout(function(){t("html,body").addClass("hideScroll")},300),a(e)}})})},addComment:function(){function a(a,i,e,o,n){function s(){c.find(".realIpt").on("input",function(){c.find(".mathIpt").val(c.find(".realIpt").val());var t=c.find(".mathIpt")[0].scrollHeight;c.find(".realIpt").css("height",t)})}function r(){c.removeClass("cur"),t("html,body").removeClass("hideScroll").animate({scrollTop:a},0),setTimeout(function(){c.remove()},250)}var d="",l=o?"回复 "+o+"：":"我来说两句...";d+='<div class="qz-pop qzPop">',d+='<header>评论<a class="qz-pop-close qzPopClose"></a><a data-userId="'+n+'" data-clubContentId="'+i+'"  data-commentId="'+e+'" class="qz-pop-smt qzPopSmt">发布</a></header>',d+='<div class="pop-con"><div class="pop-srl"><textarea class="realIpt" placeholder="'+l+'"></textarea><textarea class="mathIpt" rows="3"></textarea></div></div>',d+="</div>",t("body").append(d);var c=t(".qzPop");setTimeout(function(){c.addClass("cur")},10),s(),t(".qzPopClose").on("click",r),t(".qzPopSmt").on("click",function(){c.find(".realIpt").val();t(this).addComment(a)})}t("#qzMain").on("click",".qzBtnComment",function(){var i=t(this);i.UserOnline(function(e){if("ok"==e.status){var o=t("html").scrollTop(),n=i.data("clubcontentid"),s=i.data("commcount"),r=i.data("href"),d=i.data("userid"),l=i.data("commid"),c=i.attr("data-name");if(t("#qzCardContext").length>0)return 0===o&&(o=t("body").scrollTop()),setTimeout(function(){t("html,body").addClass("hideScroll")},300),a(o,n,l,c,d),!1;0===s||""==s?(0===o&&(o=t("body").scrollTop()),setTimeout(function(){t("html,body").addClass("hideScroll")},300),a(o,n,l,c,d)):window.location.href=r}})})},addLike:function(){t("#qzMain").on("click",".qzBtnLike",function(){var a=t(this),i=(a.closest(".qzCard").data("cid"),a.attr("data-likecount"));1===parseInt(a.attr("data-islike"))?a.removeClass("cur").attr("data-islike","0").attr("data-likecount",parseInt(i)-1).find("b").html(parseInt(i)-1):a.addClass("cur").attr("data-islike","1").attr("data-likecount",parseInt(i)+1).find("b").html(parseInt(i)+1)})},infiniteLoad:function(a,i){function e(){var e=t(a);"open"===e.attr("data-infiload")&&"function"==typeof i&&i(a,e)}function o(){var a=t("html").scrollTop(),i=t(document).height(),o=t(window).height();0===a&&(a=t("body").scrollTop()),a>i-o-100&&a>o-i&&n.isCanLoading===!0&&(n.isCanLoading=!1,e())}t(a).length>0&&t(window).scroll(function(){o()})},tabNav:function(){function a(){function a(){var a=d.offset().top,i=t("html").scrollTop();0===i&&(i=t("body").scrollTop()),i>=a?r.addClass("openQzNavFixed"):r.removeClass("openQzNavFixed")}function i(){var a=t("html"),i=a.height(),e=d.offset().top,o=a.scrollTop();0===o&&(o=t("body").scrollTop()),a.css("height",i),o>e&&t("html,body").animate({scrollTop:e},0)}function e(){var a=t("html");clearTimeout(o),o=setTimeout(function(){a.css("height","")},200)}var o,s=t(".qzNavFx"),r=t(".qzNavFxW"),d=t(".qzNavPos");a(),t(window).scroll(function(){a()}),s.find("a").on("click",function(){var a=t(this),o="#qzCardList";s.find("a").removeClass("cur"),a.addClass("cur"),t(o).html("").attr("data-pageIndex",0).attr("data-loading",!1),n.isCanLoading=!1,i(),t(o).getClub(function(){e()})})}t(".qzNavFx").length>0&&a()},pageGoto:function(){var a=t(".qz-card-list");a.on("click",".qzCard .qzZoneHref",function(){var a=t(this),i=a.data("href");window.location.href=i}),a.on("click",".qzZoneHref figure,.qzZoneHref a",function(t){t.stopPropagation()})},openVideoPop:function(){function a(a){function i(){o.removeClass("cur"),setTimeout(function(){o.remove()},250)}var e="";e+='<div class="qz-video-pop qzVideoPop">',e+='<div class="qz-video-pop-con">',e+='<iframe height="100%" width="100%" src="//player.youku.com/embed/'+a+'" frameborder=0 allowfullscreen></iframe>',e+="</div>",e+='<div class="qz-video-bar"><a class="qz-video-pop-close qzVideoPopClose"></div></a>',e+="</div>",t("body").append(e);var o=t(".qzVideoPop");setTimeout(function(){o.addClass("cur")},10),o.on("click",i),o.on("click","iframe",function(t){t.stopPropagation()})}t(".qzVideoPopBtn").on("click",function(){var i=t(this),e=i.data("href"),o="",n="//v.youku.com/v_show/id_",s=e.indexOf(n)+n.length,r=e.indexOf("==.html");o=e.substring(s,r),a(o)})},popBaiduShare:function(a,i){function e(){var t="";return t+='<div class="club-pop-baidu-mask clubPopBaidu clubPopBaiduClose"></div>',t+='<div class="club-pop-baidu-main clubPopBaidu">',t+='<div class="club-pop-baidu-head">分享</div>',t+='<div class="club-pop-baidu-body">',t+='<div class="club-pop-baidu-btns bdsharebuttonbox" data-tag="share_1"><a class="bds_tsina" data-cmd="tsina"></a><a class="bds_sqq" data-cmd="sqq"></a><a class="bds_qzone" data-cmd="qzone"></a><a class="bds_more" data-cmd="more"></a><a class="bds_count" data-cmd="count"></a></div>',t+="</div>",t+='<div class="club-pop-baidu-foot"><a class="clubPopBaiduClose">取消</a></div>',t+="</div>"}function o(){var e="//j.gamersky.com/static/api/js/share.js?cdnversion="+~(-new Date/36e5);window._bd_share_config={common:{bdText:i,bdDesc:i,bdUrl:a},share:[{tag:"share_1",bdSize:32}]},"object"==typeof _bd_share_main?_bd_share_main.init():t.getScript(e)}function n(){var a=t(".clubPopBaidu");a.removeClass("cur"),setTimeout(function(){a.remove(),r.popCommon.close()},250)}function s(){var a=e();t("body").append(a),r.popCommon.open(),setTimeout(function(){t(".clubPopBaidu").addClass("cur"),o()},50),t(".clubPopBaiduClose").on("click",function(){n()})}var r=this;s()},globalBind:function(){var a=t("#qzMain"),i=this;a.on("click",".qzBtnShare",function(){var a=t(this),e=a.data("sharetext"),o=a.data("shareurl");i.popBaiduShare(o,e)})},main:function(){s.setRem(),s.addSwpOnce(),s.addComment(),s.addContext(),s.tabNav(),s.infiniteLoad("#qzCardList",function(t,a){a.getClub()}),s.pageGoto(),s.globalBind(),t(window).resize(function(){s.setRem()})}};t.fn.UserOnline=function(a){t.ajax({type:"GET",dataType:"jsonp",url:"//i.gamersky.com/api/logincheck",success:function(i){"ok"!==i.status?(t(".ymw-loginpop-btns").insertYmwLoginPop(),t(".ymw-loginpop-btns").QZloginForm()):a(i)}})},t.fn.QZloginForm=function(){var a=t(this);a.on("click","#qqLogin",function(t){t.preventDefault();var a=window.location.href;window.location.href="//i.gamersky.com/oauth/authorizelogin?authorizetype=qq&returnUrl="+encodeURI(a)}).on("click","#sinaLogin",function(t){t.preventDefault();var a=window.location.href;window.location.href="//i.gamersky.com/oauth/authorizelogin?authorizetype=sina&returnUrl="+encodeURI(a)})},t.fn.insertYmwLoginPop=function(){t(".gsZpPopLoginClose,.gs_zp_pop_login").show(),t(".gsZpPopLoginClose").on("click",function(){t(".gs_zp_pop_login,.gsZpPopLoginClose").hide()})},t.fn.selectPhoto=function(){return this.each(function(){t(this).bind("click",function(){t("#fileupload").trigger("click"),t("#fileupload").fileupload({type:"post",dataType:"json",crossDomain:!0,maxFileSize:"5000000",url:"//i.gamersky.com/uploadpic/index",done:function(a,i){var e=i.result;if("ok"==e.status){var o=t(".qz-pic-list-li .qz-img-remove").length+1;if(o>9)alert("最多只能传9张"),t(".qz-pic-list .temp:first").remove();else{9==o&&t(".qz-pic-list-add").parent().css("display","none");var n="<img src='"+e.tiny+"' data-original='"+e.original+"' data-height=\""+e.height+'" data-width="'+e.width+'" data-type="'+e.imageclass+"\"><a class='qz-img-remove'></a>";t(".qz-pic-list .temp:first").removeClass("temp").html(n)}t(".qz-pic-list .qz-img-remove").each(function(){t(this).unbind("click"),t(this).bind("click",function(){var a=t(this).parents(".pic").find("img").attr("data-original"),i=t(".qz-pic-list-li").not(":last").length;t(this).parent(".qz-pic-list-li").remove(),t.ajax({type:"get",dataType:"json",url:"//i.gamersky.com/uploadpic/delete?origin="+a,data:{},success:function(t){}}),i<9&&t(".qz-pic-list-add").parent().css("display","block")})})}else alert("包含不支持的文件格式"),t(".qz-pic-list .temp:first").remove()},change:function(a,i){var e=0,o=parseInt(t("#fileupload").attr("data-imagesize")),n=o/1024;t.each(i.files,function(a,i){if(i.size/1024>o&&e<=0)e+=1,alert("图片容量超过"+n+"MB，无法上传！");else if(i.size/1024<=o){var s='<div class="qz-pic-list-li temp"><img src="//image.gamersky.com/webimg15/user/club/pc/loading.gif" ></div>';t(".qz-pic-list-li:first").before(s)}})}})})})},t.fn.fabuSubmit=function(i){return this.each(function(){var e=t(this),n=parseInt(e.find(".maxNum").html()),r=e.find(".mathIpt"),d=r.height(),l=parseInt(r.css("line-height")),c=15*l;r.textareaAutoHeight({minHeight:d,maxHeight:c}),e.on("focus",".mathIpt",function(){var a=t(this),i=a.attr("placeholder");a.attr("data-val",i).removeAttr("placeholder").parent().addClass("cur")}).on("blur",".mathIpt",function(){var a=t(this),i=a.attr("data-val");a.attr("placeholder",i).parent().removeClass("cur")}).on("keyup blur",".mathIpt",function(){var t=this.value.length;this.value=this.value.substr(0,n),e.find(".curNum").html(t),e.find(".fabu-num").css("display",t>0?"block":"")}),e.on("click",".qzPopSmt",function(){if("true"!=t(this).attr("data-isclick")){t(this).attr("data-isclick",!0);var e=t(".qz-pic-list-li:not(.temp)"),n=t(".fabuVideo"),r=t(".mathIpt").val(),d="",l=e.length>9?9:e.length-1;if(l>0){d=[];for(var c=0;c<l;c++){var p=e.eq(c).find("img").attr("data-type"),u=e.eq(c).find("img").attr("src"),m=u.replace("tiny","small"),f=u.replace("tiny","origin"),h=u.replace("tiny","tinysquare");"gif"==p&&(f=f.replace(".jpg",".gif"));var v=e.eq(c).find("img").attr("data-height"),g=e.eq(c).find("img").attr("data-width");d.push({tiny:u,tinysquare:h,small:m,origin:f,height:v,width:g,imageType:p})}}var b="";if(n.length>0){var z="",q="",y="",w="",C="";void 0==n.attr("data-tit")?q="视频链接":(z=n.attr("data-vid"),q=n.attr("data-tit"),w=n.attr("data-img"),C=n.attr("data-sitename")),y=n.attr("data-url"),b={image:w,title:q,videoUrl:y,videoVid:z,siteName:C}}if(""==d&&""==b&&!o(r))return void alert("你还没有输入内容!");var k={content:r,images:d,videos:b,clubId:a,device:1};t.ajax({type:"post",dataType:"json",crossDomain:!0,xhrFields:{withCredentials:!0},url:"//i.gamersky.com/club/api/addclubcontent",data:{jsondata:JSON.stringify(k)},success:function(a){if("ok"==a.dataType){t(this).attr("data-isclick",!1),t(".mathIpt").val("");var e=s.createCard(a.cardgroup);t("#qzCardList").prepend(e),s.photoSwp(),t(".qzBtnLike").like(),t(".qzBtnLike").addLike(),t(".qzBtnComment").commentCount(),t("html,body").removeClass("hideScroll").animate({scrollTop:i},0),setTimeout(function(){t(".qzPop").remove()},250)}else alert("发布失败，请重试！")}})}})})},t.fn.like=function(){var a="";t(this).each(function(){""!=a&&(a+=","),"loaded"!==t(this).attr("data-isloaded")&&(a+=t(this).attr("data-clubcontentid"))});var i={clubContentId:a};t.ajax({type:"get",dataType:"jsonp",url:"//i.gamersky.com/club/api/getlike",data:{jsondata:JSON.stringify(i)},success:function(a){if("ok"==a.status){var i=t.parseJSON(a.body);t.each(i,function(a,i){t(".qzBtnLike[data-clubcontentid='"+i.Id+"']").each(function(){t(this).attr("data-isloaded","loaded").find("b").html(i.digg),t(this).attr("data-likecount",i.digg)})})}}})},t.fn.addLike=function(a){return this.each(function(){var a=t(this);a.unbind("click"),a.click(function(i){i.preventDefault(),t(this).UserOnline(function(i){if("ok"==i.status){var e=a.attr("data-clubcontentid"),o={clubContentId:e,fromDevice:1};t.ajax({type:"get",dataType:"jsonp",url:"//i.gamersky.com/club/api/addlike",data:{jsondata:JSON.stringify(o)},success:function(i){if("err"==i.status)alert(i.body);else{var e=parseInt(a.find("b").html())+1;a.find("b").html(e),t(".tabNavCl a").eq(1).find("i").html(e)}}})}})})})},t.fn.commentCount=function(){var a="";t(this).each(function(){""!=a&&(a+=","),"loaded"!==t(this).attr("data-isloaded")&&(a+=t(this).attr("data-clubcontentid"))});var i={clubContentId:a};t.ajax({type:"get",dataType:"jsonp",url:"//i.gamersky.com/club/api/getcommentcount",data:{jsondata:JSON.stringify(i)},success:function(a){if("ok"==a.status){var i=t.parseJSON(a.body);t.each(i,function(a,i){t(".qzBtnComment[data-clubcontentid='"+i.Id+"']").each(function(){t(this).attr("data-isloaded","loaded").html(i.commentCount),t(this).attr("data-commcount",i.commentCount)})})}}})},t.fn.addComment=function(a){var i=t(this);if("true"!=i.attr("data-isclick")){i.attr("data-isclick",!0);var e=t.trim(i.parent().siblings(".pop-con").find(".mathIpt").val()),o=i.data("userid"),n=i.data("clubcontentid"),s=i.data("commentid");if(""==e)return void alert("评论不能为空！");if(e.length>=5e3)return void alert("评论不能超过5000个字符！");var r={userId:o,clubContentId:n,content:e,replyId:s,fromDevice:1};t.ajax({type:"post",dataType:"json",crossDomain:!0,xhrFields:{withCredentials:!0},url:"//i.gamersky.com/club/api/addcomment",data:{jsondata:JSON.stringify(r)},success:function(e){"ok"==e.dataType?(i.attr("data-isclick",!1),t(".qzBtnComment[data-clubcontentid="+n+"]").html("1").attr("data-commcount",1),t(".qzPop ").removeClass("cur"),t("html,body").removeClass("hideScroll").animate({scrollTop:a},0),setTimeout(function(){t(".qzPop ").remove()},250)):alert(e.body)}})}},t.fn.getClub=function(o){return this.each(function(){var r=t(this),d=t(".qzNavFx a.cur").attr("data-cfg"),l=e.listNavSetter[d].type,c=e.listNavSetter[d].sort,p=parseInt(r.attr("data-pageIndex"))+1,u=r.attr("data-pageSize"),m=r.attr("data-loading");if("true"!=m){r.attr("data-loading","true");var f=r.find(".qzCard").length,h=0,v=r.find(".qzCard:first").attr("data-cid");void 0!=v&&null!=v||(v=""),v+=",",f>=50&&(h=f-50),r.find(".qzCard:gt("+h+")").each(function(){v+=t(this).attr("data-cid")+","});var g={contentType:l,sort:c,pageIndex:p,pageSize:u,clubId:a,topicId:i,excludeIds:v};r.attr("data-pageIndex",p),t.ajax({type:"get",dataType:"jsonp",url:"//i.gamersky.com/club/api/getwebcallclubcontent",data:{jsondata:JSON.stringify(g)},beforeSend:function(){t(".qz-loadnull,.qz-loaded").remove(),r.append(n.loadingDom)},success:function(a){if(1==p&&r.attr("data-clubname",a.clubName).attr("data-topic",a.topic),"ok"==a.dataType){r.attr("data-loading","false"),r.find(".qz-loading").remove();var i=a.cardgroup.length;1==p&&0==i?r.html(n.loadnullDom).attr("data-infiload","close"):1==p&&i>0?(s.insertCard(r,a.cardgroup),r.attr("data-infiload","open"),n.isCanLoading=!0):p>1&&i>0?(s.appendCard(r,a.cardgroup),r.attr("data-infiload","open"),n.isCanLoading=!0):r.attr("data-infiload","close").append(n.loadedDom),t(".qzBtnLike").like(),t(".qzBtnLike").addLike(),t(".qzBtnComment").commentCount()}else r.find(".qz-loading").remove(),n.isCanLoading=!1,p>1?r.attr("data-loading","true").append(n.loadedDom):r.attr("data-loading","true").html(n.loadnullDom);"function"==typeof o&&o&&o()}})}})},t.fn.removeTarget=function(){return this.each(function(){t(this).find("a").attr("target","_self")})},t.fn.joinCount=function(){var e={clubId:a,topicId:i};t.ajax({type:"get",dataType:"jsonp",url:"//i.gamersky.com/club/api/getjoincount",data:{jsondata:JSON.stringify(e)},success:function(a){t(".joinCount").find("p span").eq(0).html(a.join+"人"),t(".joinCount").find("p span").eq(1).html(a.clubContent)}})},t.fn.showNav=function(){var e=this;return this.each(function(){var o={clubId:a,topicId:i};t.ajax({type:"get",dataType:"jsonp",url:"//i.gamersky.com/club/api/isshownav",data:{jsondata:JSON.stringify(o)},success:function(o){o.isElite&&t(e).find('a[data-cfg="best"]').css("display","block");var n;a>0&&(n=o.clubWapIcon),""!==t.trim(i)&&(n=o.topicWapIcon),t("#qzMain .icon img").attr("src",n)}})})},s.main(),t(document).ready(function(){t("#qzCardList").attr("data-pageIndex",0),t("#qzCardList").getClub(),t(".qzNavFx").showNav(),t(".joinCount").joinCount();var e="";a>0&&(t(".qwqz").html("前往圈子"),e="//i.gamersky.com/m/club/"+a),i>0&&(t(".qwqz").html("前往话题"),e=a>0?"//i.gamersky.com/m/topic/"+i+"?club="+a:"//i.gamersky.com/m/topic/"+i),t(".qwqz").attr("href",e)})}(jQuery);
//# sourceMappingURL=qz.wapwebcall.v1.0.1.min.js.map
